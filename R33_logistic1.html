<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Masahiko Asano" />

<meta name="date" content="2025-05-02" />

<title>33. ロジスティック回帰分析</title>

<script src="R33_logistic1_files/header-attrs-2.28/header-attrs.js"></script>
<script src="R33_logistic1_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="R33_logistic1_files/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="R33_logistic1_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="R33_logistic1_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="R33_logistic1_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="R33_logistic1_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="R33_logistic1_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="R33_logistic1_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="R33_logistic1_files/navigation-1.1/tabsets.js"></script>
<link href="R33_logistic1_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="R33_logistic1_files/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="R33_logistic1_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="R33_logistic1_files/datatables-binding-0.33/datatables.js"></script>
<link href="R33_logistic1_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="R33_logistic1_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="R33_logistic1_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="R33_logistic1_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="R33_logistic1_files/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">33. ロジスティック回帰分析</h1>
<h4 class="author">Masahiko Asano</h4>
<h4 class="date">2025-05-02</h4>

</div>


<style>

table, td, th {
  border: none;
  padding-left: 1em;
  padding-right: 1em;
  min-width: 50%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

</style>
<style type="text/css">
.kakomi-box11 {
 position: relative;
 margin: 2em auto;
 padding: 1.2em;
 color: #555555; /* 文章色 */
 background-color: #fff; /* 背景色 */
 border: 1px solid #555555; /* 枠線の太さ- 色 */
 width: 90%;
}
.title-box11 {
 position: absolute;
 padding: 0 .5em;
 left: 20px;
 top: -15px;
 font-weight: bold;
 background-color: #fff; /* タイトル背景色 */
 color: #555555; /* タイトル文字色 */
}
</style>
<p>Rを使った分析の準備</p>
<ul>
<li>ここで使うRのパッケージは次のとおり。</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="重回帰分析とロジスティック回帰分析の違い"
class="section level1">
<h1>1. 重回帰分析とロジスティック回帰分析の違い</h1>
<div id="線形回帰と非線形回帰" class="section level2">
<h2>1.1 線形回帰と非線形回帰</h2>
<p>線形回帰と非線形回帰の違い -
選挙での「候補者の成績」と「選挙で使うお金の額」の関係を調べたいとする<br />
→　つまり、お金を使う候補者ほど選挙結果がいいのか？という疑問</p>
<ul>
<li><p>説明したい対象（＝応答変数）としては 2 つ想定できる：<br />
①得票率（もしくは得票数）　　　　　・・・連続変数 =&gt; <span
style="color:blue">回帰分析</span><br />
②当落・・・当選したら1 、落選したら 0 ・・・2値変数 =&gt; <span
style="color:red">ロジスティック回帰分析</span></p></li>
<li><p>回帰分析とロジスティック回帰分析の違いを視覚的に示してみる</p></li>
</ul>
<table>
<colgroup>
<col width="25%" />
<col width="30%" />
<col width="44%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left"><span style="color:blue">回帰分析</span></th>
<th align="left"><span
style="color:red">ロジスティック回帰分析</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">応答変数</td>
<td align="left"><span style="color:blue">得票率(%)</span></td>
<td align="left"><span style="color:red">当落(0 or 1)</span></td>
</tr>
<tr class="even">
<td align="left">説明変数</td>
<td align="left"><span style="color:blue">選挙費用（百万円）</span></td>
<td align="left"><span style="color:red">選挙費用（百万円）</span></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><img src="graphs_tables/logit_1.png" width="80%" height="80%" style="display: block; margin: auto;" /></p>
<div id="主要な違い" class="section level4">
<h4>主要な違い</h4>
<p>・回帰分析の応答変数は得票率＝「連続変数」<br />
・ロジスティック回帰分析の応答変数は選挙での当落＝ 2 値変数 (1 or
0)<br />
・それぞれの図に回帰直線を図に書き入れてみる</p>
<p><img src="graphs_tables/logit_2.png" width="80%" height="80%" style="display: block; margin: auto;" />
・回帰分析では、選挙費用を使うほど得票率が大きくなっている =&gt;
問題なし<br />
・ロジスティック回帰分析でも、選挙費用を使うほど得票率が大きくなっている<br />
→　しかし、3つ問題点がある<br />
1. 当選確率（0〜1）が 1 (100%) を超えてしまうこと<br />
2. 当選確率（0〜1）がマイナスの値をとってしまうこと<br />
3. 当てはまり感がない（むりやり当てはめている感が強い）</p>
</div>
</div>
<div id="ロジット変換" class="section level2">
<h2>1.2 ロジット変換</h2>
<ul>
<li>「ロジスティック回帰分析」とは、2値変数をロジット変換した回帰分析</li>
</ul>
<div id="ロジット変換とは" class="section level3">
<h3>ロジット変換とは</h3>
<ul>
<li>2値を表す散布図を「率」に変換すると S 字になる（左の図 →
中央の図）<br />
</li>
<li>率を<strong><span
style="color:blue">ロジット変換</span></strong>すると直線になる（中央の図
→ 右の図）<br />
</li>
<li>ロジスティック回帰分析ではこの数学の特徴を使う</li>
</ul>
<p><img src="graphs_tables/logit_3.png" width="100%" height="80%" style="display: block; margin: auto;" /></p>
<ul>
<li>選挙での「当落」（左側の図）の代わりに「当選率」を考えてみる（中央の図）<br />
</li>
<li>選挙費用ごとにどれくらいの割合が当選しているかを棒グラフで表してみる<br />
</li>
<li>中央の「当選率」の棒グラフを見ると・・・</li>
</ul>
<p><img src="graphs_tables/logit_4.png" width="100%" height="80%" style="display: block; margin: auto;" /></p>
<p>・選挙費用が少ない200万円以下の人はほとんど当選していない<br />
・選挙費用が1000万円の候補者は50%程当選している<br />
・選挙費用が1600万円の候補者は75%以上が当選している<br />
・選挙費用ごとの「当選率」の対数をとって<strong><span
style="color:blue">ロジット変換</span></strong>する<br />
→　Ｓ字が直線になる<br />
→　しかし、実際のデータを使うと完璧な直線ではないものの、かなり直線ぽくなる<br />
→　この曲線を使ってロジスティック回帰分析を推定する</p>
<ul>
<li>2値変数をロジットに変換してから回帰分析を行う→ロジスティック回帰分析と呼ばれる</li>
</ul>
<p><strong><span
style="color:red">・ロジスティック回帰分析では「割合」ではなく「オッズ」で結果が示される</span></strong></p>
<div class="kakomi-box11">
<p><span class="title-box11"><code>Logit Model</code>
の基礎知識：オッズ</span></p>
<div id="オッズ-odds-とは" class="section level3">
<h3>オッズ (<code>Odds</code>) とは</h3>
<ul>
<li>例えば、選挙費用を800万円使う候補者は100人いる<br />
</li>
<li>そのうち当選したのは60人で落選したのは40人<br />
</li>
<li>この場合の当選者の「割合」と「オッズ」は次のように計算できる</li>
</ul>
<p><img src="graphs_tables/logit_7.png" width="80%" height="80%" style="display: block; margin: auto;" /></p>
<ul>
<li>「割合」は 1 を超えることはない<br />
</li>
<li>しかし、「オッズ」は 1 を超えることはある<br />
</li>
<li>「割合」も「オッズ」もどちらも起こりやすさを示す指数</li>
</ul>
<div id="オッズのまとめ" class="section level4">
<h4>オッズのまとめ</h4>
<ul>
<li>ある事象が起こる確率 <span class="math inline"><span
class="math inline">\(\mathrm{p}\)</span> と起こらない確率 <span
class="math inline">\(\mathrm{1 - p}\)</span> との比</li>
</ul>
<p><code>p</code>: ある事象が起こる確率<br />
<code>1-p</code>: ある事象が起こらない確率</p>
<p><span class="math display">\[Odds = \frac{p}{1-p}\]</span></p>
<p><img src="graphs_tables/logit_01.png" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<ul>
<li>例えば、<code>p = 0.01</code>（起こる確率が1%）の場合の
<code>Odds</code> を計算してみる<br />
</li>
<li><code>p = 0.01</code>, <code>1-p = 1-0.01= 0.99</code> を Odds
を求める式に代入する</li>
</ul>
<p><span class="math display">\[Odds = \frac{p}{1-p} = \frac{0.01}{0.99}
= \frac{1}{99} = 0.01\]</span></p>
</div>
</div>
</div>
<div class="kakomi-box11">
<p><span class="title-box11">Odds
の特徴</span>・オッズが大きいほど、その事象 <code>(p)</code>
が起こりやすい<br />
・オッズの最小値は 0<br />
・オッズ = 1 は「その事象 <code>(p)</code> が起こる確率が
50%」という意味<br />
・オッズの最大値は無限大 (<code>∞</code>)<br />
</p>
</div>
<div class="kakomi-box11">
<p><span class="title-box11">Logit Model
の基礎知識：ロジット変換</span></p>
<div id="ロジット変換とは-1" class="section level3">
<h3>ロジット変換とは</h3>
<p>・ロジット変換とは 2 値変数 (0 or 1) のオッズの対数をとること<br />
・<code>Odds</code> の下限は 0 なので、説明変数としては扱いにくい<br />
→ <code>Odds [= p / (1 - p)]</code> を対数変換し<span
style="color:red"><strong>「対数オッズ」(Log
Odds)</strong></span>を計算する<br />
→　これが <span style="color:red"><strong>logit</strong></span></p>
<p><span class="math display">\[LogOdds  =log\frac{p}{1-p} =
logit\]</span></p>
<ul>
<li>ロジット (<code>logit</code>) は対数オッズ (<code>Log Odds</code>)
として解釈できる</li>
</ul>
<p><img src="graphs_tables/logit_03.png" width="90%" height="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div class="kakomi-box11">
<p><span class="title-box11"><code>Log Odds</code> (=
<code>logit</code>) の特徴</span> ・最小値も最大値もどちらも無限大
(<code>∞</code>)<br />
・<code>Log Odds = 0</code> が意味するのは「その事象 <code>(p)</code>
が起こる確率が 50%」という意味</p>
</div>
</div>
</div>
</div>
<div id="推定方法の違い" class="section level1">
<h1>2. 推定方法の違い</h1>
<table>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">重回帰分析</td>
<td align="left">最小二乗法
(<code>OLS: Ordinary Least Square</code>)</td>
</tr>
<tr class="even">
<td align="left"><strong><span
style="color:blue">ロジスティック回帰分析</span></strong></td>
<td align="left"><strong><span style="color:blue">最尤推定法
(<code>MLE: Maximum Likelihood Estimation</code>)</span></strong></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div id="最尤推定法とは" class="section level2">
<h2>2.1 最尤推定法とは　　</h2>
<ul>
<li>最尤推定法（さいゆうすいていほう）とは、既に起きたことに対して、その背景にあることの可能性の大きさを推定する方法<br />
</li>
<li>ここでは「確率」と「尤度（ゆうど）」の違いを比較しながら、最尤推定法を解説する</li>
</ul>
<div id="確率と尤度ゆうどの違い" class="section level3">
<h3>2.1.1 確率と尤度（ゆうど）の違い</h3>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">確率</td>
<td
align="left"><strong>これから起きること</strong>の可能性の大きさ</td>
</tr>
<tr class="even">
<td align="left"><strong><span
style="color:blue">尤度</span></strong></td>
<td align="left"><span
style="color:blue"><strong>既に起きたこと</strong>に対して、その背後にある可能性の大きさ</span></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="確率-probability" class="section level3">
<h3>確率 (Probability)</h3>
<ul>
<li>中が見えない袋の中に赤玉が3個と白玉が2個、合わせて5個入っている<br />
</li>
<li>この袋から1個玉を取り出し、玉の色を確かめて袋に戻す<br />
</li>
<li>この作業を3回繰り返す</li>
</ul>
<div style="text-align: center;">
<p><img src="graphs_tables/irt_01.png" width="600" /></p>
</div>
<div id="結果" class="section level4">
<h4>結果：</h4>
<ul>
<li>1回目・・・赤<br />
</li>
<li>2回目・・・白<br />
</li>
<li>3回目・・・赤</li>
</ul>
<div id="問題" class="section level5">
<h5>問題：</h5>
<ul>
<li>結果が「赤、白、赤」になる確率は？<br />
</li>
<li>「積の公式」を使って計算できる</li>
</ul>
<p><span class="math display">\[\frac{3}{5} × \frac{2}{5} × \frac{3}{5}
= \frac{18}{125}\]</span></p>
<ul>
<li>しかし「積の公式」を使うためには<br />
→　「毎回、玉を取り出すことは互いに独立していて、互いに影響しあわない」という<strong><span
style="color:blue">「局所独立の仮定」</span></strong>が必要</li>
</ul>
</div>
</div>
</div>
<div id="尤度-likelyfood" class="section level3">
<h3>尤度 (likelyfood)</h3>
<ul>
<li>中が見えない袋の中に赤玉と白玉が合わせて5個入っている<br />
</li>
<li>この袋から1個玉を取り出し、玉の色を確かめて袋に戻す<br />
</li>
<li>この作業を3回繰り返した</li>
</ul>
<div id="結果-1" class="section level5">
<h5>結果：</h5>
<ul>
<li>結果は、1回目は赤、2回目は白、3回目は赤</li>
</ul>
</div>
<div id="問題-1" class="section level5">
<h5>問題：</h5>
<p>このような結果が得られるためには、もともと袋の中に赤玉と白玉、それぞれ何個ずつ入っていた可能性が最も高いか？</p>
<div style="text-align: center;">
<p><img src="graphs_tables/irt_03.png" width="400" /></p>
</div>
<ul>
<li>これから起こることを予測する確率の場合と異なり、玉は既に取り出されている<br />
</li>
<li>取り出された玉の結果（＝赤、白、赤）から、中が見えない袋の中の赤玉と白玉の個数を推定したい<br />
</li>
<li>既に起きたことに対して、その背後にある可能性の大きさを推定するのが<strong>尤度</strong><br />
</li>
<li>赤玉と白玉の個数はそれぞれ何個が妥当なのか？<br />
</li>
<li>それぞれの玉の個数の場合ごとの<strong>尤度</strong>を計算してみる</li>
</ul>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">玉の個数</td>
<td align="left"><strong>尤度</strong></td>
</tr>
<tr class="even">
<td align="left">赤1個、白4個の場合</td>
<td align="left"><span
class="math inline">\(\frac{1}{5}×\frac{4}{5}×\frac{1}{5}=
\frac{4}{125}\)</span></td>
</tr>
<tr class="odd">
<td align="left">赤2個、白3個の場合</td>
<td align="left"><span
class="math inline">\(\frac{2}{5}×\frac{3}{5}×\frac{2}{5}=
\frac{12}{125}\)</span></td>
</tr>
<tr class="even">
<td align="left"><strong><span
style="color:blue">赤3個、白2個の場合</span></strong></td>
<td align="left"><strong><span style="color:blue"><span
class="math inline">\(\frac{3}{5}×\frac{2}{5}×\frac{3}{5}=
\frac{18}{125}\)</span></span></strong></td>
</tr>
<tr class="odd">
<td align="left">赤4個、白1個の場合</td>
<td align="left"><span
class="math inline">\(\frac{4}{5}×\frac{1}{5}×\frac{4}{5}=
\frac{16}{125}\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<ul>
<li>取り出された玉の色が「赤、白、赤」という結果を踏まえると<br />
→　もっとも（最も）もっとも（尤も）らしいのは「赤3個、白2個」の場合</li>
</ul>
<div class="kakomi-box11">
<p><span class="title-box11">ポイント</span>
・ロジスティック回帰分析では<strong><span
style="color:blue">最尤推定法(MLE)</span></strong>という推定法を採用している<br />
・MLE: Maximum Likelihood Estimation</p>
<div id="ロジスティック回帰分析で推定したいもの" class="section level4">
<h4>ロジスティック回帰分析で推定したいもの</h4>
<ul>
<li>例えば、<code>選挙費用 (X) → 当落 (Y)</code>
という関係を分析したいとする<br />
</li>
<li>選挙費用 (X) は観測された（固定された）データなので推定できない</li>
</ul>
<div id="推定したいもの-選挙費用の回帰係数選挙費用が当落に与える影響"
class="section level5">
<h5>推定したいもの　→　選挙費用の回帰係数（選挙費用が当落に与える影響）</h5>
<ul>
<li><p>候補者の当落確率をモデルの形で計算<br />
→　最も尤度が高くなる係数の組み合わせを「推定値」とする</p></li>
<li><p>ロジスティック回帰分析における<strong>尤度</strong>とは:<br />
</p></li>
<li><p>ロジスティック回帰モデル全体が、観測された「当落データ」をどれだけうまく説明できるかの確率のこと<br />
→
すなわち、全候補者分の「当選／落選」という観測値が実際に起きる確率<br />
</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="ロジスティック回帰分析の手順" class="section level1">
<h1>3. ロジスティック回帰分析の手順</h1>
<ul>
<li>ロジスティック回帰分析の手順は次のとおりである</li>
</ul>
<ol style="list-style-type: decimal">
<li>対立仮説と帰無仮説を設定する<br />
</li>
<li>説明変数と応答変数の散布図を表示する<br />
</li>
<li>ロジスティック回帰式を求める<br />
</li>
<li>回帰係数の有意性を検定する<br />
</li>
<li>推定結果の意味を解釈する</li>
<li>ロジスティック回帰モデルの当てはまり具合を評価する</li>
</ol>
<div id="対立仮説と帰無仮説を設定する" class="section level2">
<h2><span style="color:green">3.1
対立仮説と帰無仮説を設定する</span></h2>
<ul>
<li>ここで<span
style="color:blue"><strong>検証したい仮説（＝対立仮説）</strong></span>は次のとおり</li>
</ul>
<div class="kakomi-box11">
<p><span
class="title-box11">仮説1</span>・選挙費を使えば使うほど、小選挙区での当選確率は大きい</p>
</div>
<ul>
<li>従って、否定されるために設定する<span
style="color:red"><strong>帰無仮説</strong></span>は次のようになる</li>
</ul>
<div class="kakomi-box11">
<p><span class="title-box11">帰無仮説</span>
・選挙費の額は、小選挙区での当選確率とは関係がない<br />
</p>
</div>
<ul>
<li><p>ロジスティック回帰分析における検定では、重回帰分析における検定と同様、得られた
<code>p 値</code>
が有意水準よりも小さいときに帰無仮説を棄却し、対立仮説を受け容れる</p></li>
<li><p>仮説1を検証するために次のモデルを考える</p></li>
</ul>
<div id="model-1" class="section level4">
<h4>Model 1</h4>
<p><img src="graphs_tables/logit_f08.png" width="70%" height="70%" style="display: block; margin: auto;" /></p>
<ul>
<li>ダウンロードした
2021年衆院選挙データを使い、候補者の小選挙区における当落
(<code>wlsmd</code>) を縦軸に、選挙費用 (<code>expm</code>)
を横軸にした散布図を表示する</li>
</ul>
<p><strong>データの準備 (<code>hr96-24.csv</code>)</strong></p>
<ul>
<li>ggplot2のテーマとフォントの設定を行う</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="cf">if</span> (.Platform<span class="sc">$</span>OS.type <span class="sc">==</span> <span class="st">&quot;windows&quot;</span>) { </span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">require</span>(fontregisterer)) {</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    my_font <span class="ot">&lt;-</span> <span class="st">&quot;Yu Gothic&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    my_font <span class="ot">&lt;-</span> <span class="st">&quot;Japan1&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  }</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">capabilities</span>(<span class="st">&quot;aqua&quot;</span>)) {</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  my_font <span class="ot">&lt;-</span> <span class="st">&quot;HiraginoSans-W3&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  my_font <span class="ot">&lt;-</span> <span class="st">&quot;IPAexGothic&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">9</span>,</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>                     <span class="at">base_family =</span> my_font))</span></code></pre></div>
<ul>
<li>衆議院議員総選挙の得票データ<a
href="https://asanoucla.github.io/hr96-24.csv"><code>hr96-24.csv</code></a>
をダウンロード</li>
</ul>
<p>データのダウンロードが終わったら、データを読み込み <code>hr</code>
と名前を付ける。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>hr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/hr96-24.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p>データフレーム <code>hr</code> の中身を表示する</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">names</span>(hr)</span></code></pre></div>
<pre><code> [1] &quot;year&quot;          &quot;pref&quot;          &quot;ku&quot;            &quot;kun&quot;          
 [5] &quot;wl&quot;            &quot;rank&quot;          &quot;nocand&quot;        &quot;seito&quot;        
 [9] &quot;j_name&quot;        &quot;gender&quot;        &quot;name&quot;          &quot;previous&quot;     
[13] &quot;age&quot;           &quot;exp&quot;           &quot;status&quot;        &quot;vote&quot;         
[17] &quot;voteshare&quot;     &quot;eligible&quot;      &quot;turnout&quot;       &quot;seshu_dummy&quot;  
[21] &quot;jiban_seshu&quot;   &quot;nojiban_seshu&quot;</code></pre>
<ul>
<li><code>select()</code> 関数を使って <code>year</code>,
<code>wl</code>, <code>previous</code>, <code>exp</code> という 4
つの変数だけを選ぶ<br />
</li>
<li><code>filter()</code> 関数を使って
2021年衆院選だけのデータを残す<br />
</li>
<li><code>wl</code> の中身を確認</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">unique</span>(hr<span class="sc">$</span>wl)</span></code></pre></div>
<pre><code>[1] 1 0 2</code></pre>
<ul>
<li><p>0・・・小選挙区での落選<br />
</p></li>
<li><p>1・・・小選挙区での当選<br />
</p></li>
<li><p>2・・・復活当選</p></li>
<li><p><code>wl</code> を使って、選挙結果を示す変数 <code>wlsmd</code>
（1 = 小選挙区当選、0 = その他）を作る<br />
</p></li>
<li><p><code>exp</code> を使って、選挙費用を示す変数
<code>expm</code>（単位は「百万円」）を作る</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>hr21 <span class="ot">&lt;-</span> hr <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">select</span>(year, wl, previous, exp) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wlsmd =</span> <span class="fu">ifelse</span>(wl <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">expm =</span> exp <span class="sc">/</span> <span class="dv">1000000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="fu">select</span>(year, wlsmd, expm, previous)</span></code></pre></div>
<p>データフレーム <code>hr21</code> の中身を表示する</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>hr21</span></code></pre></div>
<pre><code># A tibble: 857 × 4
    year wlsmd  expm previous
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1  2021     1 13.4         3
 2  2021     0  9.62        2
 3  2021     0 NA           0
 4  2021     1  8.82        8
 5  2021     0 11.4         0
 6  2021     1  7.42        8
 7  2021     0 11.9         3
 8  2021     1 13.0         3
 9  2021     0  7.48        6
10  2021     0  4.61        0
# ℹ 847 more rows</code></pre>
<p><strong>データ</strong>：<br />
</p>
<table>
<thead>
<tr class="header">
<th>変数名</th>
<th>詳細</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>year</code></td>
<td>衆院選が行われた年</td>
</tr>
<tr class="even">
<td><code>wlsmd</code></td>
<td>小選挙区での当落ダミー(当選 = 1, 落選 = 0)</td>
</tr>
<tr class="odd">
<td><code>previous</code></td>
<td>当選回数</td>
</tr>
<tr class="even">
<td><code>expm</code></td>
<td>候補者の選挙費用（百万円）</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>データフレーム hr21 の記述統計を表示させる</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">summary</span>(hr21)</span></code></pre></div>
<pre><code>      year          wlsmd             expm              previous     
 Min.   :2021   Min.   :0.0000   Min.   : 0.009319   Min.   : 0.000  
 1st Qu.:2021   1st Qu.:0.0000   1st Qu.: 3.435080   1st Qu.: 0.000  
 Median :2021   Median :0.0000   Median : 5.899882   Median : 1.000  
 Mean   :2021   Mean   :0.3372   Mean   : 6.434585   Mean   : 2.162  
 3rd Qu.:2021   3rd Qu.:1.0000   3rd Qu.: 8.692808   3rd Qu.: 3.000  
 Max.   :2021   Max.   :1.0000   Max.   :27.443685   Max.   :17.000  
                                 NA&#39;s   :22                          </code></pre>
<ul>
<li>データフレーム <code>hr21</code> の <code>expm</code> に欠損値
(<code>missing data = NA's</code>) が22個あることがわかる<br />
</li>
<li><code>na.omit()</code> を使って欠測のない観測だけを残す</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>hr21 <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(hr21)</span></code></pre></div>
<ul>
<li>データフレーム <code>hr21</code> の記述統計を表示して確認する</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">summary</span>(hr21)</span></code></pre></div>
<pre><code>      year          wlsmd             expm              previous     
 Min.   :2021   Min.   :0.0000   Min.   : 0.009319   Min.   : 0.000  
 1st Qu.:2021   1st Qu.:0.0000   1st Qu.: 3.435080   1st Qu.: 0.000  
 Median :2021   Median :0.0000   Median : 5.899882   Median : 1.000  
 Mean   :2021   Mean   :0.3461   Mean   : 6.434585   Mean   : 2.211  
 3rd Qu.:2021   3rd Qu.:1.0000   3rd Qu.: 8.692808   3rd Qu.: 3.000  
 Max.   :2021   Max.   :1.0000   Max.   :27.443685   Max.   :17.000  </code></pre>
<ul>
<li>22個の <code>NA's</code> が消えていることがわかる　　</li>
</ul>
</div>
</div>
<div id="説明変数と応答変数の散布図を表示する" class="section level2">
<h2><span style="color:green">3.2
説明変数と応答変数の散布図を表示する</span></h2>
<ul>
<li>分析で使うデータ (<code>hr21</code>) の記述統計を表示</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(<span class="fu">as.data.frame</span>(hr21), </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Statistic
</td>
<td>
N
</td>
<td>
Mean
</td>
<td>
St. Dev.
</td>
<td>
Min
</td>
<td>
Max
</td>
</tr>
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
year
</td>
<td>
835
</td>
<td>
2,021.000
</td>
<td>
0.000
</td>
<td>
2,021
</td>
<td>
2,021
</td>
</tr>
<tr>
<td style="text-align:left">
wlsmd
</td>
<td>
835
</td>
<td>
0.346
</td>
<td>
0.476
</td>
<td>
0
</td>
<td>
1
</td>
</tr>
<tr>
<td style="text-align:left">
expm
</td>
<td>
835
</td>
<td>
6.435
</td>
<td>
4.287
</td>
<td>
0.009
</td>
<td>
27.444
</td>
</tr>
<tr>
<td style="text-align:left">
previous
</td>
<td>
835
</td>
<td>
2.211
</td>
<td>
2.921
</td>
<td>
0
</td>
<td>
17
</td>
</tr>
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
<ul>
<li>当選回数と当落の散布図を描く.</li>
<li>2つの変数の関係を図示してみる<br />
</li>
<li>文字化けを避けるため、Macユーザは次の2行を実行する</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">10</span>, </span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>                     <span class="at">base_family =</span> <span class="st">&quot;HiraginoSans-W3&quot;</span>))</span></code></pre></div>
<ul>
<li><code>wlsmd</code> が 2 値変数 (0 or 1)
なので、<code>jitter()</code>関数を使ってデータを散らして表示させる</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hr21, <span class="fu">aes</span>(<span class="at">x =</span> expm, <span class="at">y =</span> wlsmd)) <span class="sc">+</span> </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">size =</span> <span class="dv">1</span>,        <span class="co"># データを散らして表示させる指定</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>              <span class="at">width =</span> <span class="dv">0</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>              <span class="at">height =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;選挙費用（100万円）&quot;</span>,</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;小選挙区での当落&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="fu">plot</span>(p)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>この図に<strong><span
style="color:blue">むりやり通常の回帰直線を当てはめてみる</span></strong>とこのようになる</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;label&quot;</span>, </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;当落 (0 or 1) = a + b選挙費用&quot;</span>, </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">6</span>, <span class="at">y =</span> <span class="fl">0.75</span>,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;HiraginoSans-W3&quot;</span>)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>応答変数が2値 (o or 1)
なのに、むりやり回帰直線を当てはめた時の問題点<br />
→
応答変数（当選確率）がマイナスの値になったり、100%を超える場合がある</li>
</ul>
<div id="解決策" class="section level4">
<h4>解決策</h4>
<ul>
<li>当選確率を<strong><span
style="color:green">「ロジット変換」</span></strong>する<br />
</li>
<li>当選確率 <span class="math inline">\(P\)</span> は 0 と 1
の間の値をとる 2 値変数<br />
</li>
<li><span class="math inline">\(\frac{P}{1-P}\)</span>
はオッズ（コラム<code>Logit Model の基礎知識：オッズ</code>を参照）</li>
<li>オッズ＝当選する確率 <span class="math inline"><span
class="math inline">\(\mathrm{p}\)</span> と落選する確率 <span
class="math inline">\(\mathrm{1 - p}\)</span> との比</li>
<li>「当選確率<span
class="math inline">\(P\)</span>」と「選挙費用」の関係は次の式で表現できる</li>
</ul>
<p><span class="math display">\[\frac{P}{1-p} = a + 選挙費用b +
当選回数c\]</span></p>
<ul>
<li>回帰式の左辺の<strong><span style="color:red">オッズ <span
class="math inline">\(\frac{p}{1-P}\)</span></span></strong>は曲線を表現している<br />
</li>
<li>回帰式の右辺 <strong><span style="color:blue"><span
class="math inline">\(a + 選挙費用b\)</span></span></strong>
は直線を表現している<br />
→　表現が一致していない</li>
<li>回帰式の左辺をする＝<strong><span style="color:red">オッズ <span
class="math inline">\(\frac{p}{1-P}\)</span></span></strong>の<strong><span
style="color:green">対数をとる</span></strong><br />
</li>
<li>当選確率 <span class="math inline">\(P\)</span> は 0 から 1
の範囲しか取れないが、オッズの対数をとると全ての実数をとれる<br />
→　曲線の関係を直線の関係に変更でき、推定が可能になる
＝「ロジット変換」</li>
</ul>
<p><span class="math display">\[log\frac{P}{1-p} = a + 選挙費用b +
当選回数c\]</span></p>
<p><img src="graphs_tables/logit_lm.png" width="65%" height="65%" style="display: block; margin: auto;" /></p>
</div>
<div id="オッズの対数をとった曲線" class="section level4">
<h4>オッズの対数をとった曲線</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hr21, <span class="fu">aes</span>(<span class="at">x =</span> expm, <span class="at">y =</span> wlsmd)) <span class="sc">+</span> </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>              <span class="at">width =</span> <span class="dv">0</span>,</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>              <span class="at">height =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;選挙費用（100万円）&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;小選挙区での当選確率&quot;</span>)</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="fu">print</span>(p3)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ロジスティック回帰式を求める" class="section level2">
<h2><span style="color:green">3.3
ロジスティック回帰式を求める</span></h2>
<div id="ロジスティック回帰式-model-1" class="section level4">
<h4><span style="color:green">ロジスティック回帰式
(<code>Model 1</code>)</span></h4>
<ul>
<li>ここでは2021年の衆院選データを用い、選挙費用（<code>expm</code>:
単位100万円）で衆院選小選挙区での当落 (<code>wlsmd</code>)
を説明するモデルを考える</li>
</ul>
<p><strong>Model 1</strong></p>
<p><img src="graphs_tables/logit_f08.png" width="70%" height="70%" style="display: block; margin: auto;" /></p>
<ul>
<li>このモデルを式で表すとこのようになる</li>
</ul>
<p><span class="math display">\[Pr(当選)=logit^{−1}(𝛼+\beta_1選挙費用 +
\beta_2当選回数)\]</span></p>
<ul>
<li>Rでロジスティック回帰分析を行うには、一般化線形モデル (Generalized
Linear Models: GLM) を当てはめるための関数 <code>glm()</code>
を使う<br />
</li>
<li><code>glm()</code>はロジスティック回帰以外でも頻繁に使う関数<br />
</li>
<li>この関数をロジスティック回帰分析に使うには、引数
<code>family = binomial(link = "logit")</code> を指定<br />
</li>
<li><code>logit</code> とは「<span
style="color:red">オッズ</span>の<span style="color:green">対数</span>
」= <code>Log Odds</code> のこと</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wlsmd <span class="sc">~</span> expm <span class="sc">+</span> previous, </span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>            <span class="at">data =</span> hr21, </span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)) <span class="co"># 係数を「オッズの対数」に指定</span></span></code></pre></div>
<ul>
<li><code>tidy()</code> を使って、推定結果を確認する</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">tidy</span>(model_1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code># A tibble: 3 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   -2.65     0.194     -13.7  9.90e-43   -3.04     -2.28 
2 expm           0.170    0.0235      7.23 4.86e-13    0.125     0.217
3 previous       0.342    0.0355      9.62 6.38e-22    0.274     0.413</code></pre>
<p>→　表示される回帰式の係数 <code>estimate</code> は 「<span
style="color:red">オッズ</span>の<span style="color:green">対数</span>」
= <code>Log Odds</code></p>
<ul>
<li><p><code>Log Odds</code> は解釈しにくい → 確率に変換する</p></li>
<li><p>当選確率を予測するためのロジスティック回帰式は次のとおり</p></li>
</ul>
<p><span class="math display">\[Pr(当選) = logit^{-1}(\alpha +
\beta_1選挙費用 + \beta_2当選回数)\]</span></p>
<p><span class="math display">\[= \frac{1}{1+exp(-[\alpha +
\beta選挙費用])}\]</span> <span class="math display">\[=
\frac{1}{1+exp(-[-2.65 + 0.170[expm] + 0.342[previous]])}\]</span></p>
</div>
</div>
<div id="回帰係数の有意性を検定する" class="section level2">
<h2><span style="color:green">3.4 回帰係数の有意性を検定する</span></h2>
<ul>
<li><code>tidy()</code> を使って、推定結果を再度確認してみる</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">tidy</span>(model_1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code># A tibble: 3 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   -2.65     0.194     -13.7  9.90e-43   -3.04     -2.28 
2 expm           0.170    0.0235      7.23 4.86e-13    0.125     0.217
3 previous       0.342    0.0355      9.62 6.38e-22    0.274     0.413</code></pre>
<ul>
<li><p><code>expm</code> の <code>p.value</code> は
<code>1.46e-24</code><br />
→　有意水準を 0.05 とすれば、選挙費用 (<code>expm</code>) の p値は
<code>1.61e- 5</code>
なので、「影響がない」という帰無仮説を棄却する<br />
→ 選挙費用が当選確率に影響すると判断する<br />
→　選挙費用は<strong><span style="color:magenta">「全体的にみて」</span>
</strong>当落に正の影響があり、その効果は統計的に有意と判断する（詳しくは下のコラム「<code>expm の係数をどのように解釈すべきか？</code>」参照）</p></li>
<li><p><code>previous</code> の <code>p.value</code> は
<code>4.29e-14</code><br />
→　有意水準を 0.05 とすれば、過去の当選回数 (<code>previous</code>) の
p値は <code>4.29e-14</code>
なので、「影響がない」という帰無仮説を棄却する<br />
→ 過去の当選回数が当選確率に影響すると判断する<br />
→　過去の当選回数は<strong><span
style="color:magenta">「全体的にみて」</span>
</strong>当落に正の影響があり、その効果は統計的に有意と判断する（詳しくは下のコラム「<code>expm の係数をどのように解釈すべきか？</code>」参照）</p></li>
</ul>
<div id="ロジスティック回帰分析の係数" class="section level4">
<h4>ロジスティック回帰分析の係数</h4>
<p>→　表示される回帰式の係数 <code>estimate</code> は 「<span
style="color:red">オッズ</span>の<span style="color:green">対数</span>」
= <code>Log Odds</code></p>
<ul>
<li><p><code>Log Odds</code> は解釈しにくい → 確率に変換する</p></li>
<li><p>当選確率を予測するためのロジスティック回帰式は次のとおり</p></li>
</ul>
<p><span class="math display">\[Pr(当選) = logit^{-1}(\alpha +
\beta_1選挙費用 = \beta_2当選回数)\]</span></p>
<p><span class="math display">\[= \frac{1}{1+exp(-(\alpha +
\beta選挙費用)}\]</span> <span class="math display">\[=
\frac{1}{1+exp(-(-2.65 + 0.170expm + 0.342previous))}\]</span></p>
<ul>
<li>例えば、選挙費用 (<code>expm</code>) の係数の推定値は約 0.170<br />
</li>
<li>これが重回帰分析の結果であれば、「選挙費用が 1 単位（100
万円）増えるごとに、当選確率が 0.170
ポイント大きくなる」という意味<br />
</li>
<li>しかし、ロジスティック回帰分析の係数は、重回帰分析の係数と同じように解釈できない</li>
</ul>
<div class="kakomi-box11">
<p><span class="title-box11">予測当選確率と限界効果</span></p>
<div id="予測当選確率" class="section level4">
<h4>予測当選確率</h4>
<ul>
<li>選挙費用の値ごとに候補者が当選する確率の予測値が<strong><span
style="color:blue">当選予測確率:
<code>0 〜 1</code></span></strong></li>
</ul>
<p><img src="graphs_tables/logit_f11.png" width="70%" height="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="限界効果" class="section level4">
<h4>限界効果</h4>
<ul>
<li><p>ロジスティック回帰分析の係数は、重回帰分析の係数と同じように解釈できない<br />
</p></li>
<li><p>ロジスティック曲線は直線ではない → 「曲線」<br />
<strong>→ 説明変数
1単位の変化が応答変数に与える影響（＝傾き）は説明変数の値によって異なる</strong></p></li>
<li><p>説明変数が応答変数に与える影響を考えるためには<br />
→　説明変数の値を特定し、<strong><span
style="color:red">「特定された値における影響」</span></strong>を計算する必要あり<br />
→　<strong><span style="color:red">限界効果 (Marginal
Effects)</span></strong></p></li>
<li><p>上図の例では、<code>x</code>の値 1, 5, 10, 15, 20
それぞれの時点での直線の傾きが限界効果</p></li>
</ul>
</div>
</div>
<div class="kakomi-box11">
<p><span
class="title-box11"><code>expm の係数</code>をどのように解釈すべきか？</span></p>
<ul>
<li>ここでは <code>expm</code> の係数が <code>0.170</code>
(<code>p-value = 4.86e-13</code>) という結果が得られた<br />
</li>
<li>重回帰分析では、線形モデル（＝直線）を分析している<br />
→　説明変数の値に関わらず傾き (<code>= slope</code>)
も統計的有意性も同じ<br />
</li>
<li>しかし、ロジスティック回帰分析では非線形（＝曲線）を分析<br />
→　選挙費用の大きさ次第で効果の大きさ（＝限界効果）と統計的有意性も変わる<br />
→　選挙費用 (<code>expm</code>)
が統計的に有意であれば選挙費用は<strong><span
style="color:magenta">「全体的にみて」</span>
</strong>当落に正の影響があり、その効果は統計的に有意<br />
→　しかし、これは選挙費用と当落の「平均的な関係」を示すもの<br />
→　全ての選挙費用で統計的に有意と限らない<br />
→　選挙費用ごとの統計的有意性をチェックすべき<br />
・もう一つの説明変数 <code>previous</code> も同様<br />
</li>
</ul>
</div>
</div>
<div id="予測当選確率-1" class="section level3">
<h3>予測当選確率</h3>
<ul>
<li>当選回数 (<code>previous</code>)
が3回の候補者に関して次の二つのケースを考えてみる<br />
<strong>例1: 選挙費用を<span style="color:blue">0 円から 100
万円に変化</span>させた場合の予測当選確率</strong><br />
<strong>例2: 選挙費用を<span style="color:blue">100 万円から 200
万円に変化</span>させた場合の予測当選確率</strong></li>
</ul>
<div id="例1-選挙費用-0-円-100-万円" class="section level4">
<h4>例1: 選挙費用 (0 円 → 100 万円)</h4>
<ul>
<li>ここでは<strong>当選回数が 3 回の候補者</strong>が、選挙費用を<span
style="color:blue">0 円から 100
万円に変化</span>させると、応答変数にどのような変化があるか確かめる<br />
→それぞれの<strong>予測当選確率</strong>を計算して差を取る<br />
</li>
<li>当選回数が 3 回で選挙費用が 0
円の候補者の予測当選確率は、次の回帰式に、previous = 3、expm = 0
を代入すれば求められる</li>
</ul>
<p><span class="math display">\[Pr（当選） = \frac{1}{1+exp(-(-1.98 +
0.0735expm + 0.285previous))}\]</span></p>
<ul>
<li>この値を R で求めてみる<br />
</li>
<li>当選回数が 3 回で選挙費用が 0 円の候補者の予測当選確率は</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="co">#予測当選確率を表示したい時の指定  </span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>               <span class="at">newdata =</span> <span class="fu">data_frame</span>(<span class="at">previous =</span> <span class="dv">3</span>, <span class="at">expm =</span> <span class="dv">0</span>))</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>p_0</span></code></pre></div>
<pre><code>        1 
0.1642294 </code></pre>
<ul>
<li>0.1642294 (= 約16.4%) である<br />
</li>
<li>当選回数が 3 回で選挙費用が 100 万円の候補者の予測当選確率は
　　</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>               <span class="at">newdata =</span> <span class="fu">data_frame</span>(<span class="at">previous =</span> <span class="dv">3</span>, <span class="at">expm =</span> <span class="dv">1</span>))</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>p_1</span></code></pre></div>
<pre><code>        1 
0.1889165 </code></pre>
<ul>
<li>0.1889165 (= 約18.9%)だとわかる<br />
</li>
<li>当選回数が 3 回の候補者が選挙費用を 0 円から 100
万円に変化させたときの予測当選確率の変化は、上で求めた二つの確率の差
<code>(p_1 - p_0)</code></li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>p_1 <span class="sc">-</span> p_0</span></code></pre></div>
<pre><code>         1 
0.02468706 </code></pre>
<ul>
<li>当選回数が 3 回の候補者が選挙費用を 0 円から 100
万円に増やすと、<span style="color:blue"><strong>予測当選確率は約 2.47
%ポイント増える</strong></span></li>
</ul>
</div>
<div id="例2-選挙費用-100万円-200万円" class="section level4">
<h4>例2: 選挙費用 (100万円 → 200万円)</h4>
<ul>
<li>ここでは<strong>当選回数が 3 回の候補者</strong>が、選挙費用を<span
style="color:blue">100万円から
200万円に変化</span>させると、応答変数にどのような変化があるか確かめる<br />
</li>
<li>当選回数が 3 回で選挙費用が 200万円の候補者の予測当選確率は
0.2163539（約21.6%ポイント）</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>p_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>               <span class="at">newdata =</span> <span class="fu">data_frame</span>(<span class="at">previous =</span> <span class="dv">3</span>, <span class="at">expm =</span> <span class="dv">2</span>))</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>p_2</span></code></pre></div>
<pre><code>        1 
0.2163539 </code></pre>
<ul>
<li>当選回数が 3 回の候補者が選挙費用を 100 万円から 200
万円に変化させたときの予測当選確率の変化は、上で求めた二つの確率の差
<code>(p_2 - p_1)</code> なので</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>p_2 <span class="sc">-</span> p_1</span></code></pre></div>
<pre><code>         1 
0.02743738 </code></pre>
<ul>
<li>当選回数が 3 回の候補者が選挙費用を 100 万円から
200万円に増やすと、<span style="color:blue"><strong>予測当選確率は
0.02743738 (= 約2.7% ポイント) 増える</strong></span></li>
</ul>
<div class="kakomi-box11">
<p><span class="title-box11">まとめ</span> ・選挙費用を 0 円から 100
万円に増やすと、予測当選確率は 2.47%ポイント上昇する<br />
・選挙費用を 100 万円から 200 万円に増やすと、予測当選確率は
2.7%ポイント上昇する<br />
・選挙費用の0 円から 100 万円への変化も、100 万円から 200
万円への変化も、選挙費用の増分としては同じ<br />
・しかし、それらの変化が応答変数（すなわち当選確率）に与える影響は異なる<br />
・<strong><span style="color:blue">0 円から 100 万円への 100
万円の変化より、100 万円から 200 万円への 100
万円の変化のほうが、応答変数に与える影響が大きい</span></strong><br />
・実際に何%ポイント予測当選確率が上昇するかを、具体的な予測当選確率を計算せずに係数の推定値(<code>expm = 0.170</code>)
から読み取るのは難しい<br />
</p>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
wlsmd
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
expm
</td>
<td>
0.170<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.024)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
previous
</td>
<td>
0.342<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.036)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
-2.652<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.194)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
835
</td>
</tr>
<tr>
<td style="text-align:left">
Log Likelihood
</td>
<td>
-397.969
</td>
</tr>
<tr>
<td style="text-align:left">
Akaike Inf. Crit.
</td>
<td>
801.939
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05;
<sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<p>・この推定値は「<span style="color:red">オッズ</span>の<span
style="color:green">対数</span> 」= <code>Log Odds</code> =
<code>logit</code><br />
→ いくつか特定した <code>expm</code>
の値で予測確率を計算し、その差を比較する作業が必要</p>
</div>
</div>
</div>
<div id="限界効果-1" class="section level3">
<h3>限界効果</h3>
<div id="margins-を使った限界効果の計算" class="section level4">
<h4><code>margins</code> を使った限界効果の計算</h4>
<ul>
<li>上の例のように、予測当選確率を複数計算し、その差をとるという作業を繰り返すのは面倒<br />
→ 特定の値における限界効果を直接計算するための
<code>margins</code>パッケージを使うのが便利</li>
<li><code>margins()</code>関数を使うと、特定の選挙費用額ごとの限界効果を求めることができる</li>
</ul>
<p><strong>選挙費用の限界効果 (previous = 3, expm =
400万円)</strong></p>
<ul>
<li>例えば、当選回数が 3 回で選挙費用が 400 万円のとき、選挙費用 1
単位（= 100
万円）の増加が当選確率に与える影響の大きさ（＝限界効果）は</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">margins</span>(model_1, <span class="at">variables =</span> <span class="st">&quot;expm&quot;</span>,</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>        <span class="at">at =</span> <span class="fu">list</span>(<span class="at">previous =</span> <span class="dv">3</span>, <span class="at">expm =</span> <span class="dv">4</span>))</span></code></pre></div>
<pre><code> at(previous) at(expm)    expm
            3        4 0.03424</code></pre>
<ul>
<li>選挙費用が当選確率に与える影響（限界効果）は 0.03424
(約3.4%ポイント) だとわかる</li>
</ul>
<p><strong>選挙費用の限界効果（previous = 3, expm: 0 〜
2,800万円)</strong></p>
<ul>
<li>どの値での限界効果を求めるかは、引数
<code>at</code>に変数のリストを渡すことで指定する<br />
</li>
<li>複数の値、例えば、選挙費用が 0円 (previous = 0) から 2,800万円
(previous = 3) までの限界効果を同時に表示してみる</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">margins</span>(model_1, <span class="at">variables =</span> <span class="st">&quot;expm&quot;</span>,</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="at">at =</span> <span class="fu">list</span>(<span class="at">previous =</span> <span class="dv">3</span>, <span class="at">expm =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">28</span>))) <span class="co">#選挙費用を0円から2,800万円まで指定  </span></span></code></pre></div>
<pre><code> at(previous) at(expm)     expm
            3        0 0.023337
            3        1 0.026052
            3        2 0.028827
            3        3 0.031585
            3        4 0.034239
            3        5 0.036685
            3        6 0.038820
            3        7 0.040540
            3        8 0.041758
            3        9 0.042406
            3       10 0.042449
            3       11 0.041884
            3       12 0.040742
            3       13 0.039087
            3       14 0.037004
            3       15 0.034595
            3       16 0.031964
            3       17 0.029215
            3       18 0.026437
            3       19 0.023710
            3       20 0.021093
            3       21 0.018631
            3       22 0.016352
            3       23 0.014273
            3       24 0.012397
            3       25 0.010723
            3       26 0.009241
            3       27 0.007938
            3       28 0.006801</code></pre>
<ul>
<li><span
style="color:blue"><strong>ロジスティック回帰分析の係数の限界効果は、説明変数の値によって変化する</strong></span><br />
→ 各説明変数の係数を見ただけで結果を理解するのは困難<br />
→
説明変数が応答変数に影響を与える様子をいくつかの条件について図示する<br />
→ <strong>説明変数の値に応じた限界効果 (ME:Marginal Effects)</strong>
を図示する必要がある</li>
</ul>
</div>
</div>
</div>
<div id="推定結果の意味を解釈する" class="section level2">
<h2><span style="color:green">3.5 推定結果の意味を解釈する</span></h2>
<div id="仮説-1-の結果の表示方法-model_1" class="section level3">
<h3>仮説 1 の結果の表示方法 (<code>Model_1</code>)</h3>
<div id="予測当選確率と限界効果は異なる" class="section level5">
<h5>「予測当選確率」と「限界効果」は異なる</h5>
<ul>
<li><p>「予測当選確率」は特定の選挙費用を使った候補者が当選する確率<br />
</p></li>
<li><p>「限界効果」は選挙費用が予測当選確率に与える影響（＝傾き）</p></li>
<li><p>予測当選確率と限界効果は <code>margins::cplot()</code>
を利用して図示する<br />
・Y軸に<strong>予測当選確率</strong>を表示したい時は
<code>what = "prediction"</code> と指定<br />
・Y軸に<strong>限界効果</strong>を表示したい時は
<code>what = "effect"</code> と指定</p></li>
</ul>
</div>
<div id="選挙費用と予測当選確率hr21_me" class="section level4">
<h4>「選挙費用」と「予測当選確率」(<code>hr21_me</code>)</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>hr21_me <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_1, </span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;expm&quot;</span>, </span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;選挙費用（単位：100万円）&quot;</span>, </span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;予測当選確率の予測値&quot;</span>, </span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;予測当選確率の予測値:2021総選挙&quot;</span>)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-40-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="選挙費用と選挙費用の限界効果hr21_pred" class="section level4">
<h4>「選挙費用」と「選挙費用の限界効果」」(<code>hr21_pred</code>)</h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>hr21_pred <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_1,  </span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;expm&quot;</span>,    <span class="co"># x軸に据える変数</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>                  <span class="at">dx =</span> <span class="st">&quot;expm&quot;</span>,   <span class="co"># 説明変数</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;effect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.0001</span>, <span class="fl">0.06</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;選挙費用&quot;</span>, </span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;選挙費用の限界効果&quot;</span>, </span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;選挙費用の限界効果:2021総選挙&quot;</span>)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><span style="color:darkgreen"><strong>仮説検証のまとめ（仮説
1）:</strong></span></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>hr21_me <span class="sc">+</span> hr21_pred</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-42-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="kakomi-box11">
<p><span class="title-box11">仮説検証の結論（仮説 1）</span></p>
<div id="左側の図からわかること" class="section level5">
<h5>左側の図からわかること</h5>
<p><span style="color:blue">実質的有意性</span>:<br />
<strong>・選挙費用が大きくなるにつれて、候補者の当選確率は大きくなる</strong><br />
・選挙費用が小さいとき、予測当選確率は緩やかに上昇<br />
・選挙費用が中程度になると曲線の傾きが少しずつ急になる<br />
・選挙費用が大きくなると再び傾きが小さくなる<br />
</p>
</div>
<div id="右側の図からわかること" class="section level5">
<h5>右側の図からわかること</h5>
<p><span style="color:blue">実質的有意性</span>:<br />
<strong>・選挙費用の限界効果は、約1000万円の時が最大</strong><br />
・選挙費用がそれより多くても少なくても効果が小さい<br />
→　選挙費用が約1300万円の時、当選確率に対する影響力が最大<br />
<span style="color:red">統計的有意性</span>:
全ての選挙費用の範囲で統計的に有意</p>
</div>
</div>
<ul>
<li>選挙費用の限界効果の最小値と最大値を確認したければ、次のように入力する<br />
</li>
<li>この限界効果は、モデルに含まれているコントロール変数
(<code>previous</code>) の値を平均値に固定した値である</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">margins</span>(model_1, <span class="at">variables =</span> <span class="st">&quot;expm&quot;</span>,</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="at">at =</span> <span class="fu">list</span>(<span class="at">expm =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">28</span>))) <span class="co">#選挙費用を0円から2,800万円まで指定  </span></span></code></pre></div>
<pre><code> at(expm)    expm
        0 0.01911
        1 0.02082
        2 0.02257
        3 0.02435
        4 0.02614
        5 0.02789
        6 0.02959
        7 0.03119
        8 0.03264
        9 0.03391
       10 0.03494
       11 0.03569
       12 0.03611
       13 0.03618
       14 0.03587
       15 0.03518
       16 0.03413
       17 0.03275
       18 0.03107
       19 0.02916
       20 0.02708
       21 0.02489
       22 0.02266
       23 0.02045
       24 0.01831
       25 0.01626
       26 0.01435
       27 0.01259
       28 0.01099</code></pre>
<ul>
<li><code>expm = 13</code> の時に限界効果が最大値 (0.03618)
であることが確認できる</li>
</ul>
</div>
</div>
<div id="当選回数ごとの予測当選確率" class="section level3">
<h3>当選回数ごとの予測当選確率</h3>
<div id="予測当選確率-2" class="section level4">
<h4>予測当選確率</h4>
<ul>
<li>選挙費用の額に関わりなく、選挙費用が予測当選確率に正の影響を与えていることはわかった<br />
</li>
<li>それは、候補者の当選回数が異なってもいえるのか？<br />
</li>
<li>候補者の当選回数ごとに選挙費用が予測当選確率に与える影響をチェックする<br />
</li>
<li>候補者の当選回数 (<code>previous</code>) の記述統計を確認する</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">table</span>(hr21<span class="sc">$</span>previous)</span></code></pre></div>
<pre><code>
  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  16  17 
390  79  55 106  51  31  33  30  24  16   7   3   5   2   1   1   1 </code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">hist</span>(hr21<span class="sc">$</span>previous)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-45-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><p>候補者の大多数の当選回数が 0 だとわかる<br />
</p></li>
<li><p>17回の当選回数を0から2回ずつ区切り、0, 2, 4, …,
16まで分割する<br />
→　<code>previous = seq(0, 16, by = 2)</code></p></li>
<li><p>候補者の選挙費用 (<code>expm</code>)
の記述統計を確認する</p></li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">summary</span>(hr21<span class="sc">$</span>expm)</span></code></pre></div>
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
 0.009319  3.435080  5.899882  6.434585  8.692808 27.443685 </code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">hist</span>(hr21<span class="sc">$</span>expm)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-47-1.png" width="672" style="display: block; margin: auto;" />
- 選挙費用は0円から2700万円強まで分布<br />
→ 500万円ずつ分割する →　<code>expm = seq(0, 20, by = 5))</code><br />
- 当選回数ごとの予測当選確率を可視化してみる</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>df_pre <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">previous =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">17</span>, <span class="at">by =</span> <span class="dv">2</span>), </span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>  <span class="at">expm =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() </span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_1, </span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, </span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a>  <span class="at">newdata =</span> df_pre, </span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a>  <span class="at">se.fit =</span> <span class="cn">TRUE</span>) </span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a>df_pre<span class="sc">$</span>fit <span class="ot">&lt;-</span> pred<span class="sc">$</span>fit </span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a>df_pre<span class="sc">$</span>lower <span class="ot">&lt;-</span> <span class="fu">with</span>(pred, fit <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> se.fit) </span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a>df_pre<span class="sc">$</span>upper <span class="ot">&lt;-</span> <span class="fu">with</span>(pred, fit <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> se.fit) </span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a>df_pre <span class="ot">&lt;-</span> df_pre <span class="sc">%&gt;%</span></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">lower =</span> <span class="fu">ifelse</span>(lower <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, lower), </span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">ifelse</span>(upper <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">1</span>, upper)) </span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a>plt_prob <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_pre, <span class="fu">aes</span>(<span class="at">x =</span> expm, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a><span class="fu">facet_wrap</span>(. <span class="sc">~</span> previous) <span class="sc">+</span> </span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;選挙費用（100万円）&quot;</span>, <span class="at">y =</span> <span class="st">&quot;当選確率の予測値&quot;</span>) </span>
<span id="cb51-22"><a href="#cb51-22" tabindex="-1"></a><span class="fu">print</span>(plt_prob)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-48-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>当選回数が少ない候補者は、選挙費用が当選確率の予測値に強い正の影響を与えている<br />
</li>
<li>当選回数が増えるにつれて、選挙費用が当選確率の予測値に与える影響が小さくなる<br />
→　当選回数16回の候補者は、選挙費用を使わなくても使ってもほぼ当選している</li>
</ul>
</div>
<div id="限界効果-2" class="section level4">
<h4>限界効果</h4>
<ul>
<li><p>次に、当選回数が変わっても、選挙費用が当選確率に予測値に与える影響が統計的に有意なのかどうかをチェック</p></li>
<li><p><strong><span style="color:red"><code>当選回数 (previous)</code>
が増えるにつれて、<code>選挙費用 (expm)</code>
の影響がどう変化するか</span></strong>を指定<br />
→ <code>x = "previous", dx = "expm"</code></p></li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>plt_previous <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_1, </span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;previous&quot;</span>, <span class="co"># x軸に据える変数</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>                  <span class="at">dx =</span> <span class="st">&quot;expm&quot;</span>, 　 <span class="co"># 説明変数</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;effect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;当選回数&quot;</span>, </span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;選挙費用の限界効果&quot;</span>, </span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;当選回数ごとの選挙費用の限界効果:2021総選挙&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">print</span>(plt_previous)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><code>previous = 15</code>までは、95%信頼区間が y = 0
の赤い点線に触れていない<br />
→ 当選回数が変わっても、<code>previous = 15</code>
までは、選挙費用が当選確率に予測値に与える影響が統計的に有意</li>
</ul>
<div class="kakomi-box11">
<p><span
class="title-box11">当選回数ごとの予測当選確率：まとめ</span></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>plt_prob <span class="sc">+</span> plt_previous</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="左側の図からわかること-1" class="section level5">
<h5>左側の図からわかること</h5>
<ul>
<li>当選回数が少ない候補者は、選挙費用が当選確率の予測値に強い正の影響を与えている<br />
</li>
<li>当選回数が増えるにつれて、選挙費用が当選確率の予測値に与える影響が小さくなる<br />
→　当選回数16回の候補者は、選挙費用を使わなくても使ってもほぼ当選している</li>
</ul>
</div>
<div id="右側の図からわかること-1" class="section level5">
<h5>右側の図からわかること</h5>
<ul>
<li>このことは当選回数0回から15回までの候補者に当てはまり、統計的に有意<br />
</li>
<li>選挙費用が当選確率の予測値に与える影響は当選回数が5回の候補者が最も大きい<br />
</li>
</ul>
</div>
</div>
<div class="kakomi-box11">
<p><span class="title-box11">限界効果の統計的有意性</span>
・限界効果は、説明変数 1
単位の増加が応答変数を何単位増加させるかを示す<br />
・ここでの説明変数は「選挙費用」</p>
<div id="注意限界効果と予測当選確率とは異なる" class="section level5">
<h5>注意：「限界効果」と「予測当選確率」とは異なる</h5>
<ul>
<li>「限界効果」は選挙費用が予測当選確率に与える影響（＝傾き）<br />
</li>
<li>「予測当選確率」は特定の選挙費用を使った候補者が当選する確率</li>
</ul>
<div style="text-align: center;">
<p><img src="graphs_tables/log_stat_sig.png" width="800" /></p>
</div>
<p>→ 限界効果は説明変数の値によって変化する<br />
→ 説明変数の値に応じた限界効果を示す必要がある<br />
・図中の95% 信頼区間を見ると、有権者数によって信頼区間の幅が異なる<br />
← 限界効果の標準誤差が、説明変数である選挙費用の値に応じて変わるため</p>
<p><strong>-
主な説明変数が応答変数に与える影響が統計的に有意かどうかの判断</strong></p>
<p>→
説明変数の値によって標準誤差（信頼区間）が変化する様子も示す必要がある<br />
<span
style="color:red">・上の事例では、観察された有権者数の範囲で<strong>95%信頼区間全体が
0 より大きい範囲</strong>にある<br />
→
選挙費用が選挙の当落に与える影響は、選挙費用額にかかわらず統計的に有意</span><br />
<span
style="color:red">(観察された選挙費用の範囲で<strong>95%信頼区間全体が 0
より小さい範囲</strong>にある時も統計的に有意)</span></p>
<p>・上図のように、主な説明変数が応答変数に与える影響（限界効果）の符号が、説明変数の値によって変わりうる<br />
・説明費用の値が 1
より小さければ限界効果の値はマイナス、それより大きければ限界効果の値はプラス</p>
<p>・上図に示されているように、ロジスティック回帰分析では、主な説明変数の効果が説明変数の値によって変わるだけでなく、<span
style="color:red">統計的に有意な範囲</span>と<span
style="color:blue">有意でない範囲</span>の両方をもつことがあり得る<br />
・説明変数の値が 1 より小さい、もしくは 2
より大きければ統計的に有意<br />
・説明変数の値が 1 と 2 の間では統計的に有意ではない<br />
・説明変数がどの範囲の値をとると限界効果が統計的に有意になるかどうかを、回帰分析の係数の推定値を見ただけで判断することは非常に難しい<br />
<strong>→
限界効果を図示してはじめて、限界効果がどの範囲でどのような符号をもつか、どの範囲で統計的に有意かが明らかになる</strong></p>
</div>
</div>
</div>
</div>
</div>
<div id="参考オッズ比を使った分析結果の解釈" class="section level2">
<h2>参考（オッズ比を使った分析結果の解釈）</h2>
<ul>
<li>ここでは選挙費用と選挙の当落の関係を「確率」を使って分析した<br />
</li>
<li>しかし、オッズ比を使った分析も可能なので、簡単に紹介する</li>
</ul>
<div class="kakomi-box11">
<p><span class="title-box11"><code>Logit Model</code>
の基礎知識：オッズ比</span> ・ある事象の起こりやすさを 2
つの群で比較して示す尺度</p>
<div style="text-align: center;">
<p>第 1 群の確率- - - <span
class="math inline">\(\mathrm{p}\)</span><br />
第 2 群の確率- - - <span class="math inline">\(\mathrm{q}\)</span></p>
</div>
<p>この場合の Odds Ratio は次の式で表すことができる　</p>
<p><span class="math display">\[OddsRatio=\frac{Odds[p]}{Odds[q]}\
=\frac{p/(1-p)}{q/(1-q)}\ = \frac{p(1-q)}{(1-p)q}\]</span></p>
<ul>
<li><p>例）<br />
肺がんになる確率に関する Odds 比を計算してみる<br />
第 1 群：<strong>肺がん患者100人</strong>を調査　 ⇒
80人が喫煙者、20人が非喫煙者 (肺がんの確率
<strong><code>p = 0.8</code></strong>)<br />
第 2 群：<strong>健康な100人</strong>を調査　 ⇒
20人が喫煙者、80人が非喫煙者 (肺がんの確率
<strong><code>(1 - p) = q = 0.2</code></strong>)<br />
</p></li>
<li><p>下の式に <code>p = 0.8</code>, <code>q = 0.2</code> を代入して
<code>Odds Ratio</code> を求めると<br />
<span class="math display">\[OddsRatio=\frac{Odds[p]}{Odds[q]}\
=\frac{p/(1-p)}{q/(1-q)}\ = \frac{p(1-q)}{(1-p)q}  =
\frac{0.8(1-0.2)}{(1-0.8)0.2} = \frac{4.0}{0.25} = 16\]</span></p></li>
<li><p>下の表からも、<code>p = 0.8</code> の時の
<code>Odds Ratio = 4</code>、<code>p = 0.2</code> の時の
<code>Odds Ratio = 0.25</code> が確認できる</p></li>
</ul>
<p><img src="graphs_tables/logit_02.png" width="90%" height="90%" style="display: block; margin: auto;" /></p>
<ul>
<li><code>Odds Ratio = 1</code> ⇒ 事象の起こりやすさが両群で同じ<br />
</li>
<li><code>Odds Ratio &gt; 1</code> ⇒ 事象が第 1 群で起こりやすい<br />
</li>
<li><code>Odds Ratio &lt; 1</code> ⇒ 事象が第 2 群で起こりやすい</li>
</ul>
<p>例）<code>Odds Ratio = 16</code> が意味するのは「第 2
群と比べると、第 1
群では喫煙者が肺がんである可能性が非喫煙者の16倍」</p>
</div>
<ul>
<li>model_1 の分析結果は次のとおり</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">tidy</span>(model_1)</span></code></pre></div>
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)   -2.65     0.194     -13.7  9.90e-43
2 expm           0.170    0.0235      7.23 4.86e-13
3 previous       0.342    0.0355      9.62 6.38e-22</code></pre>
<ul>
<li>表示される回帰式の係数 <code>estimate</code> は 「<span
style="color:red">オッズ</span>の<span style="color:green">対数</span>」
= <code>Log Odds</code><br />
</li>
<li><code>Log Odds</code> は解釈しにくい →
<code>exp()</code>関数を使ってオッズ比に変換する</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">tidy</span>(model_1, </span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, </span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code># A tibble: 3 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   0.0705    0.194     -13.7  9.90e-43   0.0476     0.102
2 expm          1.19      0.0235      7.23 4.86e-13   1.13       1.24 
3 previous      1.41      0.0355      9.62 6.38e-22   1.32       1.51 </code></pre>
<ul>
<li><code>expm</code> のオッズ比は 1.19<br />
</li>
<li><code>Odds Ratio &gt; 1</code> ⇒ 事象が第 1
群で起こりやすい（つまり当選しがち）<br />
→　選挙費用 (<code>expm</code>)
が100万円増えるにつれて、当選するオッズが 約1.9倍になる<br />
</li>
<li><code>previous</code> のオッズ比は 1.4<br />
→　当選回数 (<code>previous</code>)
が1回増えるにつれて、当選するオッズが 約1.4倍になる</li>
<li>いずれも統計的に有意 (<code>p.value</code> が0.05以下)</li>
</ul>
<p>注：もし係数が 1 以下なら、「当選するオッズが下がる」</p>
</div>
<div id="ロジスティック回帰モデルの当てはまり具合を評価する"
class="section level2">
<h2><span style="color:green">3.6
ロジスティック回帰モデルの当てはまり具合を評価する</span></h2>
<ul>
<li>ロジスティック回帰分析の当てはまり具合を評価する方法は次の 3
つ:　　</li>
</ul>
<p><strong>(1) 予測の的中率</strong><br />
<strong>(2) ROC 曲線と AUC</strong><br />
<strong>(3) 赤池情報量基準: AID</strong></p>
<ul>
<li><p>予測の的中率</p></li>
<li><p>ここで説明しようとしているのは次のモデル<br />
</p></li>
<li><p>応答変数は二値変数で、各候補者が「当選」か「落選」か (wlsmd = 1
or 0)</p></li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wlsmd <span class="sc">~</span> previous <span class="sc">+</span> expm, </span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>               <span class="at">data =</span> hr21,</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li>上で推定したロジスティック回帰式は、当落をどの程度正確に予測しているかを調べる<br />
</li>
<li>「予測値に基づく当落」と「実際の当落」をクロス集計表にする<br />
</li>
<li>当選確率が 0.5 以上という予測 = 「当選」と予測したと考える<br />
</li>
<li>model_1 の予測値を <code>fitted()</code>関数を使って取り出し<br />
　→「予測値に基づく当落」と「実際の当落」をクロス集計表にする</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>Pred <span class="ot">&lt;-</span> (<span class="fu">fitted</span>(model_1) <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),　</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;落選予測&quot;</span>, <span class="st">&quot;当選予測&quot;</span>))</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a><span class="fu">table</span>(Pred, hr21<span class="sc">$</span>wlsmd) <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span></code></pre></div>
<pre><code>          
Pred         0   1 Sum
  落選予測 476 120 596
  当選予測  70 169 239
  Sum      546 289 835</code></pre>
<p><span style="color:blue">【予想値に基づく当落】</span></p>
<p><strong>・実際に落選した 546 人のうち、落選と予測されたのは 476
人</strong><br />
・残りの 70 人については当選という誤った予測<br />
<strong>・実際に当選した 289 人のうち、169
人については当選という正しい予測</strong><br />
・実際に当選した 298 人のうち 120 人については落選という誤った予測<br />
<strong>・全体としては、835 人中 645 人 (476 人 + 169 人)
については正しい予測</strong><br />
・残りの 190 人については誤った予測<br />
<strong>→　従って、このモデルの的中率は、645/835 (約77%)</strong></p>
<ul>
<li>この「77%」という的中率をどう評価すべきか？<br />
</li>
<li>ロジスティック回帰によって予測の的中率が 0 % から77%
に上がったわけではない</li>
</ul>
<p><span style="color:blue">【実際の当落 = 的中率】</span></p>
<p><strong>- ここでは 835 人の候補者中、実際には 289
人が当選</strong><br />
→ 説明変数を何も加えず「全員当選」という予測をすれば<br />
<strong>→ 予測の精度は 289/835 (約34%)</strong></p>
<div class="kakomi-box11">
<p><span class="title-box11">予測の的中率 </span> model_1 は「的中率」を
34% から 77% へ 43 ポイント上げた</p>
</div>
<p>ロジスティック回帰の予測精度が高いといえるかどうかは、説明変数をいっさい使わなくても得られる「的中率」と比較して評価する</p>
<ul>
<li><code>ROC</code> 曲線と <code>AUC</code><br />
</li>
</ul>
<ol style="list-style-type: decimal">
<li>目視によるモデルの当てはまり具合の評価方法<br />
<strong>受信者操作特性（<code>receiver operating characteristic：ROC</code>）曲線</strong></li>
</ol>
<p><strong>ROC 曲線の描き方</strong><br />
ROC 線の横軸には、偽陽性率（<span style="color:red"><strong>false
positive</strong></span> rate：FPR）と呼ばれるものを使う<br />
- 偽陽性とは「本当は陰性なのに誤って陽性と判断されること」　　<br />
- ここでは<span
style="color:red"><strong>「本当は落選したのに当選と予測すること」=
偽陽性</strong></span><br />
- 当落の境界線を当選確率 0.5 に設定すると、偽陽性率は 55/678
（下図参照）</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>Pred <span class="ot">&lt;-</span> (<span class="fu">fitted</span>(model_1) <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),　<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;落選予測&quot;</span>, <span class="st">&quot;当選予測&quot;</span>))</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a><span class="fu">table</span>(Pred, hr21<span class="sc">$</span>wlsmd) <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span></code></pre></div>
<pre><code>          
Pred         0   1 Sum
  落選予測 476 120 596
  当選予測  70 169 239
  Sum      546 289 835</code></pre>
<ul>
<li>偽陽性は誤った判断なので、偽陽性率は小さくなることが望ましい<br />
</li>
<li>縦軸には、真陽性率（<span style="color:blue"><strong>true
positive</strong></span> rate：TPR）を使う<br />
</li>
<li>真陽性率は感度（sensitivity）とも呼ばれる<br />
</li>
<li>真陽性とは「本当は陽性のときに陽性であると正しく判断されること」<br />
</li>
<li>ここでは<span
style="color:blue"><strong>「実際に当選した候補者を当選すると予測すること」=
真陽性</strong></span>　　<br />
</li>
<li>当落の境界線を当選確率 0.5 に設定した場合の感度は
169/289（上の表を参照）<br />
</li>
<li>感度は正しい判断の確率を表すので、大きいほうが望ましい</li>
</ul>
<p><strong>- 当てはまりがよいモデルのROC 曲線:</strong><br />
→ 点(0, 0) から点(0,1) の近くに進み、そこから点(1, 1)
に向かって進む曲線<br />
<strong>- 当てはまりの悪いモデルのROC 曲線:</strong><br />
→ ROC 曲線が 45 度線の近くを通過する　　</p>
<ul>
<li>ここで推定している二つのモデルは次のとおり</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wlsmd <span class="sc">~</span> expm, <span class="at">data =</span> hr21,</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wlsmd <span class="sc">~</span> expm <span class="sc">+</span> previous, <span class="at">data =</span> hr21,</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li>交差項を含まない <code>model_1</code> と交差項を含む
<code>model_2</code>
のどちらの当てはまりがよいかを、<code>ROC曲線</code>を描いて考える<br />
</li>
<li><code>ROC曲線</code>を描くために <strong>ROCR
パッケージ</strong>を使う<br />
</li>
<li><code>prediction()</code> という名前の関数は <strong>ROCR</strong>
パッケージだけでなく <strong>margins</strong> パッケージにもある<br />
→どちらの関数を使うか明記する　　</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a>pi1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>pi2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_2, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a>pr1 <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(pi1, <span class="at">labels =</span> hr21<span class="sc">$</span>wlsmd <span class="sc">==</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>pr2 <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(pi2, <span class="at">labels =</span> hr21<span class="sc">$</span>wlsmd <span class="sc">==</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a>roc1 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr1, <span class="at">measure =</span> <span class="st">&quot;tpr&quot;</span>, <span class="at">x.measure =</span> <span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a>roc2 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr2, <span class="at">measure =</span> <span class="st">&quot;tpr&quot;</span>, <span class="at">x.measure =</span> <span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a>df_roc <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">fpr =</span> <span class="fu">c</span>(roc1<span class="sc">@</span>x.values[[<span class="dv">1</span>]], roc2<span class="sc">@</span>x.values[[<span class="dv">1</span>]]),</span>
<span id="cb66-8"><a href="#cb66-8" tabindex="-1"></a>                     <span class="at">tpr =</span> <span class="fu">c</span>(roc1<span class="sc">@</span>y.values[[<span class="dv">1</span>]], roc2<span class="sc">@</span>y.values[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb66-9"><a href="#cb66-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Model 1&quot;</span>, <span class="st">&quot;Model 2&quot;</span>), <span class="fu">c</span>(<span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>, <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>)))</span>
<span id="cb66-10"><a href="#cb66-10" tabindex="-1"></a>roc <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_roc, <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr,</span>
<span id="cb66-11"><a href="#cb66-11" tabindex="-1"></a>                          <span class="at">color =</span> model, <span class="at">linetype =</span> model)) <span class="sc">+</span> </span>
<span id="cb66-12"><a href="#cb66-12" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" tabindex="-1"></a><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;偽陽性率（1 - 特異度）&quot;</span>, <span class="at">y =</span> <span class="st">&quot;真陽性率（感度）&quot;</span>)</span>
<span id="cb66-18"><a href="#cb66-18" tabindex="-1"></a><span class="fu">print</span>(roc)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-61-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="kakomi-box11">
<p><span class="title-box11"><code>ROC</code>曲線による当てはまり
</span> 青色 (model_2) の<code>ROC</code> 曲線は 45
度線（点線）から点(0, 1)
のほうに離れており、モデルの当てはまりがいい</p>
</div>
<p><strong>(2)
数値指標によるモデルの当てはまり具合の評価方法</strong></p>
<div id="auc" class="section level4">
<h4>AUC</h4>
<ul>
<li><p>目視だけで当てはまり具合の良し悪しを判断するのには限界がある<br />
→ AUC（<strong>area under the curve</strong>：ROC
曲線の下側の面積）を使って評価する<br />
</p></li>
<li><p>上のROCを求めた図中の 0 ≤x ≤1、0 ≤y ≤1 の範囲で ROC
曲線より下の面積を求める<br />
</p></li>
<li><p>すべての ROC 曲線が2 点(0, 0) と(1, 1)
を通り、当てはまりのよいモデル ほど(1, 1) の近くを通る<br />
</p></li>
<li><p>ROC 曲線が 3 点(0, 0)、(0, 1)、(1, 1) を通るなら
→曲線の下側の面積は 1<br />
</p></li>
<li><p><strong>当てはまりのよいモデルの AUC</strong> → 1
に近くなる</p></li>
<li><p><strong>当てはまりの悪いモデルの AUC</strong> → 0.5
に近くなる<br />
　　（←ROC 曲線は 45 度線に近づくため）</p></li>
<li><p>ROC曲線で見る限り、二つのモデルの当てはまりのよさに大きな差はなさそう<br />
</p></li>
<li><p>念のため、<code>AUC</code>を計算する</p></li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>auc1 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr1, <span class="at">measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>auc1<span class="sc">@</span>y.values[[<span class="dv">1</span>]]   <span class="co"># model_1 のAUC</span></span></code></pre></div>
<pre><code>[1] 0.7825171</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>auc2 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pr2, <span class="at">measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>auc2<span class="sc">@</span>y.values[[<span class="dv">1</span>]]   <span class="co"># model_2 のAUC</span></span></code></pre></div>
<pre><code>[1] 0.853502</code></pre>
<div class="kakomi-box11">
<p><span class="title-box11"><code>AUC</code> による当てはまり </span>
<code>AUC</code>を見る限り、<code>model_2</code>
の当てはまりの方がよい</p>
</div>
</div>
<div id="赤池情報量基準-aid" class="section level4">
<h4>赤池情報量基準 (<code>AID</code>)</h4>
<ul>
<li>赤池情報量基準 (<code>AID: Akaike information criterion</code>)
を使う<br />
</li>
<li>多くの説明変数を使っても(=
パラメータ数が増えても)、それに応じた分だけ尤度が増加しなければ、そのモデルは「良いモデル」とは言えない<br />
</li>
<li>この基準で評価するのが <code>AID</code><br />
</li>
<li><code>AIC</code> が最小のモデルが「最も良いモデル」とされる</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">AIC</span>(model_1)</span></code></pre></div>
<pre><code>[1] 917.4406</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">AIC</span>(model_2)</span></code></pre></div>
<pre><code>[1] 801.9386</code></pre>
<div class="kakomi-box11">
<p><span class="title-box11"><code>AID</code> による当てはまり </span>
<code>model_2</code> の当てはまりの方がよい</p>
</div>
</div>
</div>
</div>
<div id="ロジスティック回帰分析の実例" class="section level1">
<h1>4. ロジスティック回帰分析の実例</h1>
<div id="出場順番と優勝との関係m1-決勝" class="section level2">
<h2>4.1 出場順番と優勝との関係（M1 決勝）</h2>
<div class="figure" style="text-align: center">
<img src="graphs_tables/M1_2022.png" alt="M1グランプリについての解説はこちらを参照：[M-1グランプリ2022](https://ja.wikipedia.org/wiki/M-1%E3%82%B0%E3%83%A9%E3%83%B3%E3%83%97%E3%83%AA2022)  " width="70%" height="70%" />
<p class="caption">
M1グランプリについての解説はこちらを参照：<a
href="https://ja.wikipedia.org/wiki/M-1%E3%82%B0%E3%83%A9%E3%83%B3%E3%83%97%E3%83%AA2022">M-1グランプリ2022</a>
</p>
</div>
<ul>
<li>この分析で使うデータ</li>
</ul>
<table>
<colgroup>
<col width="41%" />
<col width="25%" />
<col width="32%" />
</colgroup>
<thead>
<tr class="header">
<th>変数名</th>
<th>内容</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ID</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>No</td>
<td>回</td>
<td></td>
</tr>
<tr class="odd">
<td>Year</td>
<td>開催年</td>
<td></td>
</tr>
<tr class="even">
<td>Rank</td>
<td>最終順位</td>
<td></td>
</tr>
<tr class="odd">
<td>Name</td>
<td>コンビ名</td>
<td></td>
</tr>
<tr class="even">
<td>Company</td>
<td>所属事務所名</td>
<td></td>
</tr>
<tr class="odd">
<td>Entry_No</td>
<td>エントリー番号</td>
<td></td>
</tr>
<tr class="even">
<td>Since</td>
<td>コンビ結成年</td>
<td></td>
</tr>
<tr class="odd">
<td>No_Finals</td>
<td>これまでの決勝進出回数</td>
<td>当該年を除く</td>
</tr>
<tr class="even">
<td>Catchphrase</td>
<td>キャッチフレーズ</td>
<td></td>
</tr>
<tr class="odd">
<td><span style="color:red"><strong>Final</strong></span></td>
<td><span
style="color:red"><strong>最終決戦進出（0：進出せず、1:進出）</strong></span></td>
<td><span style="color:red"><strong>従属変数</strong></span></td>
</tr>
<tr class="even">
<td><span style="color:blue"><strong>Order10</strong></span></td>
<td><span
style="color:blue"><strong>決勝における出場順番</strong></span></td>
<td><span style="color:blue"><strong>独立変数</strong></span></td>
</tr>
<tr class="odd">
<td>Order3</td>
<td>最終決戦における出場順番</td>
<td>最終決戦に進出しなかったコンビは欠損値</td>
</tr>
<tr class="even">
<td>Score10</td>
<td>決勝における評価</td>
<td></td>
</tr>
<tr class="odd">
<td>Score3</td>
<td>最終決戦における評価</td>
<td>最終決戦に進出しなかったコンビは欠損値</td>
</tr>
<tr class="even">
<td>No_Reviewer</td>
<td>審査委員数</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>・この分析で使うデータはここからダウンロード： <a
href="https://asanoucla.github.io/M1_Grand_Pix_2022.csv">M1_Grand_Pix_2022.csv</a><br />
・出典：<a
href="https://github.com/JaehyunSong/M-1_Grand_Pix">https://github.com/JaehyunSong/M-1_Grand_Pix</a></p>
<div id="データの準備" class="section level3">
<h3>データの準備</h3>
<ul>
<li>ファイル (<code>M1_Grand_Pix_2022.csv</code>)
をダウンロードする</li>
<li>Rプロジェクトフォルダ内に <code>data</code>
という名称のフォルダを作成<br />
</li>
<li><code>data</code> フォルダ内に
<code>M1_Grand_Pix_2022.csv</code>を置く<br />
</li>
<li>ファイル (<code>M1_Grand_Pix_2022.csv</code>) を読み込み
<code>df_m1</code> と名前を付ける</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>df_m1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/M1_Grand_Pix_2022.csv&quot;</span>)</span></code></pre></div>
<ul>
<li>分析しやすいように <code>Zombie</code> と <code>Winner</code>
という二つの変数を作る</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>df_m1 <span class="ot">&lt;-</span> df_m1 <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Zombie =</span> <span class="fu">if_else</span>(Catchphrase <span class="sc">==</span> <span class="st">&quot;（敗者復活）&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># 敗者復活したかどうか（0:しない、1:した）　　</span></span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>         <span class="at">Winner =</span> <span class="fu">if_else</span>(Rank <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="co"># 最終決戦で優勝したどうか（0: 2 位もしくは 3 位、1: 優勝）</span></span></code></pre></div>
<ul>
<li><code>df_m1</code> の中身ははこんな感じ</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(df_m1)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ecf3d089bc7c39e69d88" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ecf3d089bc7c39e69d88">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169],[2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2002,2002,2002,2002,2002,2002,2002,2002,2002,2003,2003,2003,2003,2003,2003,2003,2003,2003,2004,2004,2004,2004,2004,2004,2004,2004,2004,2005,2005,2005,2005,2005,2005,2005,2005,2005,2006,2006,2006,2006,2006,2006,2006,2006,2006,2007,2007,2007,2007,2007,2007,2007,2007,2007,2008,2008,2008,2008,2008,2008,2008,2008,2008,2009,2009,2009,2009,2009,2009,2009,2009,2009,2010,2010,2010,2010,2010,2010,2010,2010,2010,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022],[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,4,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,5,7,8,8,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],["中川家","ハリガネロック","アメリカザリガニ","ますだおかだ","麒麟","フットボールアワー","キングコング","チュートリアル","DonDokoDon","おぎやはぎ","ますだおかだ","フットボールアワー","笑い飯","おぎやはぎ","ハリガネロック","テツandトモ","スピードワゴン","ダイノジ","アメリカザリガニ","フットボールアワー","笑い飯","アンタッチャブル","2丁拳銃","りあるキッズ","スピードワゴン","アメリカザリガニ","麒麟","千鳥","アンタッチャブル","南海キャンディーズ","麒麟","タカアンドトシ","笑い飯","POISON GIRL BAND","トータルテンボス","東京ダイナマイト","千鳥","ブラックマヨネーズ","笑い飯","麒麟","品川庄司","チュートリアル","千鳥","タイムマシーン3号","アジアン","南海キャンディーズ","チュートリアル","フットボールアワー","麒麟","笑い飯","トータルテンボス","ライセンス","ザ・プラン9","変ホ長調","POISON GIRL BAND","サンドウィッチマン","トータルテンボス","キングコング","ハリセンボン","笑い飯","ザブングル","ダイアン","千鳥","POISON GIRL BAND","NON STYLE","オードリー","ナイツ","笑い飯","U字工事","ダイアン","モンスターエンジン","キングコング","ザ・パンチ","パンクブーブー","笑い飯","NON STYLE","ナイツ","ハライチ","東京ダイナマイト","モンスターエンジン","南海キャンディーズ","ハリセンボン","笑い飯","スリムクラブ","パンクブーブー","ピース","銀シャリ","ナイツ","ハライチ","ジャルジャル","カナリア","トレンディエンジェル","銀シャリ","ジャルジャル","タイムマシーン3号","スーパーマラドーナ","和牛","メイプル超合金","馬鹿よ貴方は","ハライチ","銀シャリ","和牛","スーパーマラドーナ","さらば青春の光","アキナ","ハライチ","カミナリ","スリムクラブ","相席スタート","とろサーモン","和牛","ミキ","かまいたち","スーパーマラドーナ","ジャルジャル","さや香","ゆにばーす","カミナリ","マヂカルラブリー","霜降り明星","和牛","ジャルジャル","ミキ","かまいたち","トム・ブラウン","スーパーマラドーナ","ギャロップ","見取り図","ゆにばーす","ミルクボーイ","かまいたち","ぺこぱ","和牛","見取り図","からし蓮根","オズワルド","すゑひろがりず","インディアンス","ニューヨーク","マヂカルラブリー","おいでやすこが","見取り図","錦鯉","オズワルド","ニューヨーク","インディアンス","アキナ","ウエストランド","東京ホテイソン","錦鯉","オズワルド","インディアンス","ロングコートダディ","もも","真空ジェシカ","ゆにばーす","モグライダー","ハライチ","ランジャタイ","ウエストランド","さや香","ロングコートダディ","男性ブランコ","真空ジェシカ","ヨネダ2000","オズワルド","カベポスター","キュウ","ダイヤモンド"],["吉本興業 大阪","吉本興業 大阪","松竹芸能","松竹芸能","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","プロダクション人力舎","松竹芸能","吉本興業 大阪","吉本興業 大阪","プロダクション人力舎","吉本興業 東京","ニチエンプロダクション","M2カンパニー","吉本興業 東京","松竹芸能","吉本興業 大阪","吉本興業 大阪","プロダクション人力舎","吉本興業 東京","吉本興業 大阪","ホリプロコム","松竹芸能","吉本興業 大阪","吉本興業 大阪","プロダクション人力舎","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 大阪","吉本興業 東京","吉本興業 東京","オフィス北野","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 大阪","吉本興業 大阪","アップフロントエージェンシ","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 大阪","無所属","吉本興業 東京","フラットファイヴ","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","ワタナベエンターテインメント","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 東京","ケイダッシュステージ","マセキ芸能社","吉本興業 大阪","アミー・パーク","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 東京","マセキ芸能社","ワタナベエンターテインメント","吉本興業 東京","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","マセキ芸能社","ワタナベエンターテインメント","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 東京","太田プロダクション","吉本興業 大阪","吉本興業 大阪","サンミュージックプロダクション","オフィス北野","ワタナベエンターテインメント","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","ザ・森東","吉本興業 大阪","ワタナベエンターテインメント","グレープカンパニー","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 大阪","吉本興業 東京","グレープカンパニー","吉本興業 東京","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 東京","ケイダッシュステージ","吉本興業 大阪","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 大阪","吉本興業 東京","サンミュージックプロダクション","吉本興業 東京","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","SMA","吉本興業 東京","吉本興業 東京","吉本興業 東京","吉本興業 大阪","タイタン","グレープカンパニー","SMA","吉本興業 東京","吉本興業 東京","吉本興業 大阪","吉本興業 大阪","プロダクション人力舎","吉本興業 東京","マセキ芸能社","ワタナベエンターテインメント","グレープカンパニー","タイタン","吉本興業 大阪","吉本興業 大阪","吉本興業 東京","プロダクション人力舎","吉本興業 東京","吉本興業 東京","吉本興業 大阪","タイタン","吉本興業 東京"],[438,94,1118,713,1034,1181,209,80,859,855,1754,1726,166,1755,1739,746,821,1740,1751,1895,1906,609,484,1902,1880,1888,1870,1885,2560,2598,2566,2584,2617,2604,2591,898,2585,3365,3378,3330,3338,3349,3348,3347,3319,3357,3895,3909,3877,3922,3899,3917,3882,3912,3913,4201,4216,2735,3567,4239,4200,4207,4210,4230,4467,4431,4464,4489,4486,4455,4485,4440,4441,4610,4629,4603,4600,4608,4598,4624,4602,4609,4835,4802,4820,3036,4792,4816,4818,4797,4789,2311,1928,2021,1128,634,73,878,390,2929,1949,1796,171,2479,231,1888,73,2453,1843,2465,2467,1826,37,2000,2831,1346,776,3642,777,349,1206,3933,2071,2851,919,843,2077,2197,2852,297,4440,846,4547,3659,189,1178,1365,3328,2594,2617,2178,3474,3471,728,1602,3182,3006,3473,3000,3761,2372,3107,4141,6,76,3355,635,2179,3033,3312,2852,4948,1795,26,1794,3311,4491,3402,1771],[1992,1995,1994,1993,1998,1999,1999,1998,1994,1995,1993,1999,2000,1995,1995,1998,1998,1994,1994,1999,2000,1994,1993,1996,1998,1994,1998,1998,1994,2003,1998,1994,2000,2000,1997,2001,1998,1998,2000,1998,1995,1998,1998,2000,1997,2003,1998,1999,1998,2000,1997,1996,2001,2005,2000,1998,1997,1999,2003,2000,1999,2000,1998,2000,2000,2000,2000,2000,2000,2000,2007,1999,1998,2001,2000,2000,2000,2005,2001,2007,2003,2003,2000,2005,2001,2003,2005,2000,2005,2003,2003,2004,2005,2003,2000,2003,2006,2012,2008,2005,2005,2006,2003,2008,2012,2005,2011,2005,2013,2002,2006,2012,2004,2003,2003,2014,2013,2011,2007,2013,2006,2003,2012,2004,2009,2003,2004,2007,2013,2007,2004,2008,2006,2007,2013,2014,2011,2010,2010,2007,2019,2007,2012,2014,2010,2010,2012,2008,2015,2012,2014,2010,2009,2017,2012,2013,2009,2006,2007,2008,2014,2009,2011,2012,2020,2014,2014,2013,2017],[0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,1,0,1,0,0,0,1,2,1,0,1,0,2,0,2,0,0,0,1,0,3,3,0,1,2,0,0,1,2,3,4,4,1,0,0,0,1,0,2,1,0,5,0,0,3,2,0,0,0,6,0,1,0,2,0,0,7,1,1,0,1,1,2,1,8,0,1,0,0,2,1,0,0,0,1,1,1,0,0,0,0,2,2,1,1,0,0,3,0,1,0,0,2,0,0,2,2,0,0,1,0,0,3,3,1,1,0,3,0,0,1,0,2,0,4,1,0,0,0,0,0,1,0,2,0,1,1,1,1,0,0,1,2,2,0,0,0,2,0,4,0,1,1,1,0,1,0,3,0,0,0],["笑いのDNA","武闘派","3オクターブの衝撃","実力主義","無印（ノーマーク）","奇跡の顔面","驚異のルーキー","お笑い陰陽師","無冠の帝王","東京の星","打倒吉本を合言葉に今年も決勝へ","漫才新人賞を総なめにしてきた若手実力派","今年もM-1予選にノーシードの新星が現れた","前回東京からはただ1組の決勝進出","前回準優勝 リベンジだけに燃えたこの1年","現代版音楽漫才がM-1に新風を吹き込む","（敗者復活）","大分県出身の重量級コンビが涙の初出場","昨年は高熱をおして堂々の第3位","3年連続3回目","∞（インフィニティ）","（敗者復活）","ラストチャンス","最年少","正門突破","3度目の正直","返り咲き","無印（ノーマーク）","悲願の正面突破","初物尽くし","（敗者復活）","直球勝負","予測不能","支離滅裂のアーティスト","The渋谷系","\"ビート\"の遺伝子","リベンジ","モテない男たちの逆襲","予測不能のWボケ","M-1チルドレン","不屈のお調子者","暴走するイケメン漫才[108]","（敗者復活）","DVD版：アキバ系カリスマデブ","肉と骨のハーモニー","相方以上恋人未満","華麗なる妄想族","帰ってきた王者","空腹のファンタジスタ","予測不能のWボケ","ハンパねぇ渋谷系漫才","（敗者復活）","5人の漫才革命児","史上最強のアマチュア","暴走する異次元漫才","（敗者復活）","ハンパねぇラストチャンス","帰ってきたスーパールーキー","（デブ+ヤセ）×ブサイク=爆笑","予測不能のWボケ","奇跡の顔面","お笑い月見草","オレ流漫才","屈辱からの脱出","ストリート系漫才","（敗者復活）","浅草の星","孤高のWボケ","I ♥ とちぎ","お笑い月見草","変幻自在の高性能漫才","逆襲のスーパールーキー","ラストチャッチャチャーンス","9年目の正直","孤高のWボケ","（敗者復活）","浅草の星","原市生まれM-1育ち","逆襲の異端児","ネタの精密機械","漫才という名の赤い糸","恋する漫才師","孤高のWボケ","無印(ノーマーク)島人(しまんちゅ)","（敗者復活）","笑いのアーティスト","昭和をまとった新世代","浅草の星","進化するムチャぶり漫才","スーパールーキー","羽ばたけ!ラストイヤー[117]","（敗者復活）","昭和をまとった新世代 再び!","フリースタイルが止まらない!","器用なおデブさんは好きですか?","震える子羊ボケまくる!","心にさされ!非情な愛のボケ","誰も知らない超ダークホース","静かなる毒舌漫才","澤部、今日も騒ぐってよ","王道漫才","（敗者復活）","虚弱 × 最強","予測不能","変幻自在","シン・ハライチ","ダークホース","一撃必殺","婚活系漫才","ついにキターーー！！","3度目の正直","兄弟漫才","史上初の2冠へ[124]","（敗者復活）","帰ってきたフリースタイル","無印（ノーマーク）","野生女×インドア男","進化のどつき漫才","摩訶不思議","縦横無尽","第4形態","フリースタイル再び","（敗者復活）","史上初の2冠へ","無秩序","最後の逆襲","輝け！いぶし銀","声高ダークホース","今年もイェエエエイ！","ナニワスパイラル","憑依する漫才","ツッコミ方改革","（敗者復活）","真逆の個性","火の国ストロング","新・東京スタイル","令和の伝統芸能","ノンストップ","漫才ジョーカー","我流大暴れ","個性と技のハーモニー","真逆の才能Ⅲ","おっさんずバカ","NEO東京スタイル","ダークにリベンジ","（敗者復活）","覚醒するファンタジスタ","小市民怒涛の叫び","静ボケ 剛ツッコミ","50歳おバカの大冒険","シン・東京スタイル","快速ボケ特急","やわらかハード","なにわNEWフェイス","屈折のエリート","NO M-1,NO LIFE.","やんちゃとぶきっちょ","（敗者復活）","奇天烈の極み","小市民怒涛の叫び","熱血リベンジ","ゆるハイブリッド","あぶない地味男","アンコントロール","なかよし奇想天外","（敗者復活）","草食系ロジカル","ノーリアル","クレイジーな輝き"],[1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],[1,10,4,8,7,2,6,3,9,5,2,5,6,7,1,4,9,3,8,7,4,9,5,8,3,6,2,1,8,5,9,2,7,6,4,3,1,5,1,8,6,4,9,7,2,3,6,2,4,8,5,9,3,7,1,9,5,6,7,1,3,8,4,2,7,9,4,2,5,1,3,8,6,8,5,9,1,6,3,7,2,4,6,3,9,8,4,5,7,2,1,9,6,5,8,3,4,1,2,7,4,9,7,8,1,6,2,5,3,3,9,8,5,4,10,7,1,2,6,9,10,4,7,3,8,2,5,1,6,7,2,10,3,6,5,8,4,9,1,6,5,4,9,7,3,1,8,10,2,8,6,9,7,10,5,3,1,4,2,10,5,4,6,2,8,3,1,9,7],[1,2,null,null,null,null,null,null,null,null,3,1,2,null,null,null,null,null,null,3,1,2,null,null,null,null,null,null,1,3,2,null,null,null,null,null,null,3,2,1,null,null,null,null,null,null,3,2,1,null,null,null,null,null,null,3,1,2,null,null,null,null,null,null,2,3,1,null,null,null,null,null,null,2,3,1,null,null,null,null,null,null,2,1,3,null,null,null,null,null,null,2,1,3,null,null,null,null,null,null,3,2,1,null,null,null,null,null,null,1,3,2,null,null,null,null,null,null,null,3,2,1,null,null,null,null,null,null,null,3,2,1,null,null,null,null,null,null,null,2,3,1,null,null,null,null,null,null,null,2,3,1,null,null,null,null,null,null,null,1,3,2,null,null,null,null,null,null,null],[829,809,796,770,741,726,707,637,614,540,612,621,567,561,545,539,535,534,525,663,656,616,608,601,572,564,554,552,673,639,634,615,615,603,587,583,582,659,633,646,626,622,607,571,564,552,664,640,627,626,613,609,597,576,570,651,646,650,608,604,597,593,580,577,644,649,640,637,623,619,614,612,591,651,668,641,634,628,614,610,607,595,668,644,668,629,627,626,620,606,592,825,818,834,816,813,806,796,791,788,470,469,459,448,446,446,441,441,436,645,653,650,640,640,636,628,626,618,607,662,656,648,638,636,633,617,614,606,594,681,660,654,652,649,639,638,637,632,616,649,658,648,643,642,642,625,622,622,617,655,665,655,649,645,638,638,637,636,628,659,667,660,650,647,647,639,634,620,616],[6,1,null,null,null,null,null,null,null,null,5,2,0,null,null,null,null,null,null,4,3,0,null,null,null,null,null,null,6,1,0,null,null,null,null,null,null,4,3,0,null,null,null,null,null,null,7,0,0,null,null,null,null,null,null,4,2,1,null,null,null,null,null,null,5,2,0,null,null,null,null,null,null,7,0,0,null,null,null,null,null,null,4,3,0,null,null,null,null,null,null,6,2,1,null,null,null,null,null,null,3,1,1,null,null,null,null,null,null,4,3,0,null,null,null,null,null,null,null,4,3,0,null,null,null,null,null,null,null,6,1,0,null,null,null,null,null,null,null,3,2,2,null,null,null,null,null,null,null,5,1,1,null,null,null,null,null,null,null,6,1,0,null,null,null,null,null,null,null],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,9,9,9,9,9,9,9,9,5,5,5,5,5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>No<\/th>\n      <th>Year<\/th>\n      <th>Rank<\/th>\n      <th>Name<\/th>\n      <th>Company<\/th>\n      <th>Entry_No<\/th>\n      <th>Since<\/th>\n      <th>No_Finals<\/th>\n      <th>Catchphrase<\/th>\n      <th>Final<\/th>\n      <th>Order10<\/th>\n      <th>Order3<\/th>\n      <th>Score10<\/th>\n      <th>Score3<\/th>\n      <th>No_Reviewer<\/th>\n      <th>Zombie<\/th>\n      <th>Winner<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,6,7,8,10,11,12,13,14,15,16,17]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"No","targets":1},{"name":"Year","targets":2},{"name":"Rank","targets":3},{"name":"Name","targets":4},{"name":"Company","targets":5},{"name":"Entry_No","targets":6},{"name":"Since","targets":7},{"name":"No_Finals","targets":8},{"name":"Catchphrase","targets":9},{"name":"Final","targets":10},{"name":"Order10","targets":11},{"name":"Order3","targets":12},{"name":"Score10","targets":13},{"name":"Score3","targets":14},{"name":"No_Reviewer","targets":15},{"name":"Zombie","targets":16},{"name":"Winner","targets":17}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>ロジステック回帰分析で使う変数一覧</li>
</ul>
<table>
<colgroup>
<col width="12%" />
<col width="53%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">変数名</th>
<th align="left">内容</th>
<th align="left">備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span
style="color:red"><strong>Final</strong></span></td>
<td align="left"><span style="color:red"><strong>最終決戦でトップ 3
に残れたどうか（0: 残れず、1: 残れた）</strong></span></td>
<td align="left"><span
style="color:red"><strong>従属変数</strong></span></td>
</tr>
<tr class="even">
<td align="left"><span
style="color:blue"><strong>Order10</strong></span></td>
<td align="left"><span style="color:blue"><strong>決勝における出場順番
(1 〜 10）</strong></span></td>
<td align="left"><span
style="color:blue"><strong>独立変数</strong></span></td>
</tr>
<tr class="odd">
<td align="left">Since</td>
<td align="left">コンビ結成年</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">No_Finals</td>
<td align="left">これまでの決勝進出回数</td>
<td align="left">当該年を除く</td>
</tr>
<tr class="odd">
<td align="left">Zombie</td>
<td align="left">敗者復活したコンビなら 1、それ以外は 0</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<ul>
<li>データの記述統計を表示</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="fu">stargazer</span>(<span class="fu">as.data.frame</span>(df_m1),</span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Statistic
</td>
<td>
N
</td>
<td>
Mean
</td>
<td>
St. Dev.
</td>
<td>
Min
</td>
<td>
Max
</td>
</tr>
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
No
</td>
<td>
169
</td>
<td>
85.000
</td>
<td>
48.930
</td>
<td>
1
</td>
<td>
169
</td>
</tr>
<tr>
<td style="text-align:left">
Year
</td>
<td>
169
</td>
<td>
2,011.509
</td>
<td>
7.071
</td>
<td>
2,001
</td>
<td>
2,022
</td>
</tr>
<tr>
<td style="text-align:left">
Rank
</td>
<td>
169
</td>
<td>
5.189
</td>
<td>
2.719
</td>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td style="text-align:left">
Entry_No
</td>
<td>
169
</td>
<td>
2,610.000
</td>
<td>
1,477.452
</td>
<td>
6
</td>
<td>
4,948
</td>
</tr>
<tr>
<td style="text-align:left">
Since
</td>
<td>
169
</td>
<td>
2,003.609
</td>
<td>
6.336
</td>
<td>
1,992
</td>
<td>
2,020
</td>
</tr>
<tr>
<td style="text-align:left">
No_Finals
</td>
<td>
169
</td>
<td>
0.905
</td>
<td>
1.346
</td>
<td>
0
</td>
<td>
8
</td>
</tr>
<tr>
<td style="text-align:left">
Final
</td>
<td>
169
</td>
<td>
0.314
</td>
<td>
0.465
</td>
<td>
0
</td>
<td>
1
</td>
</tr>
<tr>
<td style="text-align:left">
Order10
</td>
<td>
169
</td>
<td>
5.207
</td>
<td>
2.725
</td>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td style="text-align:left">
Order3
</td>
<td>
53
</td>
<td>
1.981
</td>
<td>
0.820
</td>
<td>
1
</td>
<td>
3
</td>
</tr>
<tr>
<td style="text-align:left">
Score10
</td>
<td>
169
</td>
<td>
628.941
</td>
<td>
72.934
</td>
<td>
436
</td>
<td>
834
</td>
</tr>
<tr>
<td style="text-align:left">
Score3
</td>
<td>
53
</td>
<td>
2.377
</td>
<td>
2.177
</td>
<td>
0
</td>
<td>
7
</td>
</tr>
<tr>
<td style="text-align:left">
No_Reviewer
</td>
<td>
169
</td>
<td>
7.000
</td>
<td>
0.655
</td>
<td>
5
</td>
<td>
9
</td>
</tr>
<tr>
<td style="text-align:left">
Zombie
</td>
<td>
169
</td>
<td>
0.101
</td>
<td>
0.302
</td>
<td>
0
</td>
<td>
1
</td>
</tr>
<tr>
<td style="text-align:left">
Winner
</td>
<td>
169
</td>
<td>
0.107
</td>
<td>
0.309
</td>
<td>
0
</td>
<td>
1
</td>
</tr>
<tr>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
</div>
<div id="ロジステック回帰分析の実行" class="section level3">
<h3>ロジステック回帰分析の実行</h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Final <span class="sc">~</span> Order10 <span class="sc">+</span> Since <span class="sc">+</span> No_Finals <span class="sc">+</span> Zombie, </span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>            <span class="at">data =</span> df_m1, </span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li>分析結果を表示する　　</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">stargazer</span>(model_1,</span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Final
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Order10
</td>
<td>
0.243<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.072)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Since
</td>
<td>
-0.030
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.029)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
No_Finals
</td>
<td>
0.345<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.136)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Zombie
</td>
<td>
0.126
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.559)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
58.151
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(57.454)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
169
</td>
</tr>
<tr>
<td style="text-align:left">
Log Likelihood
</td>
<td>
-94.747
</td>
</tr>
<tr>
<td style="text-align:left">
Akaike Inf. Crit.
</td>
<td>
199.494
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05;
<sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">plot_summs</span>(model_1)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-71-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="最終決戦に選ばれる確率" class="section level3">
<h3>最終決戦に選ばれる確率</h3>
<ul>
<li><code>Order10</code> の係数 <code>0.243</code>
を見ると、「決勝における出場順番
(<code>Order10</code>)」と「最終決戦進出
(<code>Final</code>)」に正の関係があることがわかる<br />
</li>
<li>しかし、この係数係数 <code>0.243</code> は
<code>logit = Log Odds</code> を表している<br />
→ このままでは解釈が難しい<br />
→ 出場順番が 1 から 10 まで変化する（=
出場が遅くなる）場合それぞれにおける<span
style="color:red"><strong>最終決戦に選ばれる確率</strong></span>を計算してみる</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>model_1 <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order10 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order10)&quot;</span>) </span></code></pre></div>
<pre><code> Order Prediction      SE     z         p   lower  upper
     1     0.1400 0.04326 3.236 1.213e-03 0.05519 0.2248
     2     0.1700 0.04250 3.999 6.352e-05 0.08668 0.2533
     3     0.2048 0.04042 5.066 4.057e-07 0.12557 0.2840
     4     0.2446 0.03763 6.499 8.110e-11 0.17081 0.3183
     5     0.2892 0.03576 8.087 6.096e-16 0.21913 0.3593
     6     0.3384 0.03738 9.052 1.399e-19 0.26511 0.4116
     7     0.3913 0.04417 8.860 7.991e-19 0.30477 0.4779
     8     0.4471 0.05524 8.094 5.763e-16 0.33884 0.5554
     9     0.5044 0.06834 7.380 1.581e-13 0.37044 0.6383
    10     0.5618 0.08133 6.907 4.941e-12 0.40236 0.7212</code></pre>
<ul>
<li>この結果を可視化すると次のようになる</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>fig_1 <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_1, </span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;Order10&quot;</span>, </span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>, </span>
<span id="cb84-9"><a href="#cb84-9" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;最終決戦に出場する確率の予測値&quot;</span>, </span>
<span id="cb84-10"><a href="#cb84-10" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;Fig.1:出場順と最終決戦出場予測値&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb84-13"><a href="#cb84-13" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-73-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>「出場順番」が変化するにつれて「出場順番」が「最終決戦に選ばれる確率」に与える影響力（＝傾き＝限界効果）は大きくなってる</li>
<li>出場順番が 1 から 10 まで変化するにつれて（=
出場が遅くなるほど）<br />
→　<span
style="color:red"><strong>最終決戦に選ばれる確率</strong></span>が大きくなっていることがわかる<br />
</li>
<li>出場順番が 1 番の場合　→　<code>Order</code> が 1 の
<code>Prediction</code> の値は <code>0.1400</code><br />
→　最終決戦に選ばれる確率は約 <code>0.14 (= 14%)</code><br />
</li>
<li>95% 信頼区間を見るとその確率のブレ幅は 5.5% から 22% の間<br />
</li>
<li>出場順番が 10 番の場合　→　<code>Order</code> が 10 の
<code>Prediction</code> の値は <code>0.5618</code><br />
→　最終決戦に選ばれる確率は約 <code>56%</code><br />
</li>
<li>その確率のブレ幅は 40% から 72% の間</li>
</ul>
<div
id="ロジステック回帰分析では説明変数この場合だと-order10の値ごとに傾きが異なる"
class="section level5">
<h5>ロジステック回帰分析では、説明変数（この場合だと
<code>Order10</code>）の値ごとに傾きが異なる</h5>
<p>→　<code>Order10</code>
の値ごとの傾き（＝限界効果）を調べる必要がある</p>
</div>
</div>
<div id="限界効果-3" class="section level3">
<h3>限界効果</h3>
<ul>
<li>「出場順番」が「最終決戦に選ばれる確率」に与える影響力（＝傾き＝限界効果）は「出場順番」の値によって異なる<br />
→　「出場順番」ごとの「限界効果」をチェック<br />
</li>
<li>横軸が「出場順番」(<code>Order10</code>)<br />
</li>
<li>縦軸が「限界効果」(<code>Marginal effect of Order10</code>)</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>fig_2 <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_1, </span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;Order10&quot;</span>,   <span class="co"># x軸に据える変数</span></span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>                  <span class="at">dx =</span> <span class="st">&quot;Order10&quot;</span>,  <span class="co"># 説明変数</span></span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;effect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>, </span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;出場順番の平均限界効果&quot;</span>, </span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;Fig.2: 出場順番の平均限界効果&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb85-16"><a href="#cb85-16" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-74-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>「最終決戦に選ばれる確率」と「限界効果」の結果を一つのグラフにまとめて表示する</li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a>fig_1 <span class="sc">+</span> fig_2</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-75-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="左側の-fig_1" class="section level4">
<h4>左側の fig_1</h4>
<ul>
<li>出場順番が 1 から 10 まで変化するにつれて（=
出場が遅くなるほど）<br />
→　<span
style="color:red"><strong>最終決戦に選ばれる確率</strong></span>が大きくなっている</li>
</ul>
</div>
<div id="右側の-fig_2" class="section level4">
<h4>右側の fig_2</h4>
<ul>
<li>95%信頼区間が縦軸 = 0 を交わっていない<br />
→　「出場順番」(<code>Order10</code>) が 1 から 10
のいずれにおいても、統計的に有意</li>
</ul>
</div>
</div>
<div id="棒グラフと線グラフで可視化" class="section level3">
<h3>棒グラフと線グラフで可視化</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Final <span class="sc">~</span> Order10 <span class="sc">+</span> Since <span class="sc">+</span> No_Finals <span class="sc">+</span> Zombie, </span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>            <span class="at">data =</span> df_m1, </span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li><code>df_m1</code> を使って、出場順番 (<code>Order10</code>)
ごとに最終決戦進出に進出する確率を計算する<br />
</li>
<li>結果を <code>Mean_final</code> というデータフレームに格納する</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a>bar_df_m1 <span class="ot">&lt;-</span> df_m1 <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Order10) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Final =</span> <span class="fu">mean</span>(Final))</span>
<span id="cb88-4"><a href="#cb88-4" tabindex="-1"></a>bar_df_m1</span></code></pre></div>
<pre><code># A tibble: 10 × 2
   Order10 Mean_Final
     &lt;dbl&gt;      &lt;dbl&gt;
 1       1      0.111
 2       2      0.167
 3       3      0.111
 4       4      0.389
 5       5      0.444
 6       6      0.389
 7       7      0.222
 8       8      0.278
 9       9      0.611
10      10      0.571</code></pre>
<ul>
<li>出場順番 (<code>Order10</code>)
ごとに最終決戦進出に進出する確率を棒グラフで可視化する</li>
<li><code>model_1</code> の推定結果を線グラフで可視化する</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a>model_1 <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order10 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order10)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data =</span> bar_df_m1,</span>
<span id="cb90-7"><a href="#cb90-7" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> Order10, </span>
<span id="cb90-8"><a href="#cb90-8" tabindex="-1"></a>               <span class="at">y =</span> Mean_Final), </span>
<span id="cb90-9"><a href="#cb90-9" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;Identity&quot;</span>, </span>
<span id="cb90-10"><a href="#cb90-10" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, </span>
<span id="cb90-12"><a href="#cb90-12" tabindex="-1"></a>                      <span class="at">y =</span> Prediction, </span>
<span id="cb90-13"><a href="#cb90-13" tabindex="-1"></a>                      <span class="at">ymin =</span> lower,  <span class="co"># 進出確率の最小値</span></span>
<span id="cb90-14"><a href="#cb90-14" tabindex="-1"></a>                      <span class="at">ymax =</span> upper), <span class="co"># 進出確率の最大値</span></span>
<span id="cb90-15"><a href="#cb90-15" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, </span>
<span id="cb90-17"><a href="#cb90-17" tabindex="-1"></a>                <span class="at">y =</span> Prediction), </span>
<span id="cb90-18"><a href="#cb90-18" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb90-19"><a href="#cb90-19" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb90-20"><a href="#cb90-20" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb90-21"><a href="#cb90-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>,</span>
<span id="cb90-22"><a href="#cb90-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;最終決戦へ進出する確率&quot;</span>,</span>
<span id="cb90-23"><a href="#cb90-23" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;M-1グランプリ (2001-2022)&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-24"><a href="#cb90-24" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-25"><a href="#cb90-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-26"><a href="#cb90-26" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) </span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-78-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="グラフの解釈" class="section level4">
<h4>グラフの解釈：</h4>
<ul>
<li><strong>棒グラフ</strong>は単純にそれぞれの出場順番の出場者が最終決戦に出場した確率を表す</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>bar_df_m1 <span class="ot">&lt;-</span> df_m1 <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Order10) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Final =</span> <span class="fu">mean</span>(Final))</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>bar_df_m1</span></code></pre></div>
<pre><code># A tibble: 10 × 2
   Order10 Mean_Final
     &lt;dbl&gt;      &lt;dbl&gt;
 1       1      0.111
 2       2      0.167
 3       3      0.111
 4       4      0.389
 5       5      0.444
 6       6      0.389
 7       7      0.222
 8       8      0.278
 9       9      0.611
10      10      0.571</code></pre>
<ul>
<li><strong>線グラフ</strong>はロジステック回帰分析
(<code>model_1</code>) による推定結果</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>model_1 <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order10 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a href="#cb93-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order10)&quot;</span>)</span></code></pre></div>
<pre><code> Order Prediction      SE     z         p   lower  upper
     1     0.1400 0.04326 3.236 1.213e-03 0.05519 0.2248
     2     0.1700 0.04250 3.999 6.352e-05 0.08668 0.2533
     3     0.2048 0.04042 5.066 4.057e-07 0.12557 0.2840
     4     0.2446 0.03763 6.499 8.110e-11 0.17081 0.3183
     5     0.2892 0.03576 8.087 6.096e-16 0.21913 0.3593
     6     0.3384 0.03738 9.052 1.399e-19 0.26511 0.4116
     7     0.3913 0.04417 8.860 7.991e-19 0.30477 0.4779
     8     0.4471 0.05524 8.094 5.763e-16 0.33884 0.5554
     9     0.5044 0.06834 7.380 1.581e-13 0.37044 0.6383
    10     0.5618 0.08133 6.907 4.941e-12 0.40236 0.7212</code></pre>
</div>
</div>
</div>
<div id="出場順番と優勝との関係m1-最終決戦" class="section level2">
<h2>4.2 出場順番と優勝との関係（M1 最終決戦）</h2>
<ul>
<li><p>「決勝」において 10 組から 3 組だけが「最終決戦」に選ばれる<br />
</p></li>
<li><p>ここでは「最終決戦」に選ばれた 3
組の中における出場順番と優勝との関係を分析する</p></li>
<li><p>ロジステック回帰分析で使う変数一覧</p></li>
</ul>
<table>
<colgroup>
<col width="12%" />
<col width="53%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">変数名</th>
<th align="left">内容</th>
<th align="left">備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span
style="color:red"><strong>Winner</strong></span></td>
<td align="left"><span
style="color:red"><strong>最終決戦で優勝したかどうか（0：2 位もしくは 3
位、1 = 優勝）</strong></span></td>
<td align="left"><span
style="color:red"><strong>従属変数</strong></span></td>
</tr>
<tr class="even">
<td align="left"><span
style="color:blue"><strong>Order3</strong></span></td>
<td align="left"><span
style="color:blue"><strong>最終決戦における出場順番</strong></span></td>
<td align="left"><span
style="color:blue"><strong>独立変数</strong></span></td>
</tr>
<tr class="odd">
<td align="left">Since</td>
<td align="left">コンビ結成年</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">No_Finals</td>
<td align="left">これまでの決勝進出回数</td>
<td align="left">当該年を除く</td>
</tr>
<tr class="odd">
<td align="left">Zombie</td>
<td align="left">敗者復活したコンビなら 1、それ以外は 0</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div id="ロジステック回帰分析の実行-1" class="section level3">
<h3>ロジステック回帰分析の実行</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Winner <span class="sc">~</span> Order3 <span class="sc">+</span> Since <span class="sc">+</span> No_Finals <span class="sc">+</span> Zombie, </span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>            <span class="at">data =</span> df_m1, </span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li>分析結果を表示する　　</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="fu">stargazer</span>(model_2,</span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Winner
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Order3
</td>
<td>
0.775<sup>*</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.411)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Since
</td>
<td>
-0.090
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.057)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
No_Finals
</td>
<td>
-0.288
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.221)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Zombie
</td>
<td>
-1.296
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.981)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
179.137
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(113.774)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
53
</td>
</tr>
<tr>
<td style="text-align:left">
Log Likelihood
</td>
<td>
-30.299
</td>
</tr>
<tr>
<td style="text-align:left">
Akaike Inf. Crit.
</td>
<td>
70.598
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05;
<sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="fu">plot_summs</span>(model_2)</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-83-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="優勝する確率" class="section level3">
<h3>優勝する確率</h3>
<ul>
<li><code>Order3</code> の係数 <code>0.775</code>
を見ると、「決勝における出場順番
(<code>Order3</code>)」と「最終決戦で優勝したかどうか
(<code>Final</code>)」に正の関係があることがわかる<br />
</li>
<li>しかし、この係数係数 <code>0.775</code> は
<code>logit = Log Odds</code> を表している<br />
→ このままでは解釈が難しい<br />
→ 出場順番が 1 から 3 まで変化する（=
出場が遅くなる）場合それぞれにおける<span
style="color:red"><strong>優勝する確率</strong></span>を計算してみる</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>model_2 <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order3 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order3)&quot;</span>) </span></code></pre></div>
<pre><code> Order Prediction      SE     z         p   lower  upper
     1     0.2011 0.07818 2.573 1.009e-02 0.04791 0.3544
     2     0.3385 0.06355 5.326 1.003e-07 0.21393 0.4630
     3     0.5066 0.10855 4.666 3.066e-06 0.29379 0.7193</code></pre>
<ul>
<li>この結果を可視化すると次のようになる</li>
</ul>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a>fig_3 <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_2, </span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;Order3&quot;</span>, </span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>, </span>
<span id="cb100-9"><a href="#cb100-9" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;優勝する確率の予測値&quot;</span>, </span>
<span id="cb100-10"><a href="#cb100-10" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;Fig.3:出場順と優勝予測値&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-11"><a href="#cb100-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-12"><a href="#cb100-12" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb100-13"><a href="#cb100-13" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-85-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>「出場順番」が変化するにつれて「出場順番」が「優勝する確率」に与える影響力（＝傾き＝限界効果）は大きくなってる</li>
<li>出場順番が 1 から 3 まで変化するにつれて（=
出場が遅くなるほど）<br />
→　<span
style="color:red"><strong>優勝する確率</strong></span>が大きくなっていることがわかる<br />
</li>
<li>出場順番が 1 番の場合　→　<code>Order</code> が 1 の
<code>Prediction</code> の値は <code>0.2011</code><br />
→　最終決戦に選ばれる確率は約 <code>0.2011 (= 20%)</code><br />
</li>
<li>95% 信頼区間を見るとその確率のブレ幅は 4.8% から 35% の間<br />
</li>
<li>出場順番が 3 番の場合　→　<code>Order</code> が 3 の
<code>Prediction</code> の値は <code>0.5066</code><br />
→　最終決戦に選ばれる確率は約 <code>51%</code><br />
</li>
<li>その確率のブレ幅は 29% から 72% の間</li>
</ul>
<div
id="ロジステック回帰分析では説明変数この場合だと-order3の値ごとに傾きが異なる"
class="section level5">
<h5>ロジステック回帰分析では、説明変数（この場合だと
<code>Order3</code>）の値ごとに傾きが異なる</h5>
<p>→　<code>Order3</code>
の値ごとの傾き（＝限界効果）を調べる必要がある</p>
</div>
</div>
<div id="限界効果-4" class="section level3">
<h3>限界効果</h3>
<ul>
<li>「出場順番」が「最終決戦に選ばれる確率」に与える影響力（＝傾き＝限界効果）は「出場順番」の値によって異なる<br />
→　「出場順番」ごとの「限界効果」をチェック<br />
</li>
<li>横軸が「出場順番」(<code>Order3</code>)<br />
</li>
<li>縦軸が「限界効果」(<code>Marginal effect of Order3</code>)</li>
</ul>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a>fig_4 <span class="ot">&lt;-</span> <span class="fu">cplot</span>(model_2, </span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;Order3&quot;</span>,    <span class="co"># x軸に据える変数</span></span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a>                  <span class="at">dx =</span> <span class="st">&quot;Order3&quot;</span>,   <span class="co"># 説明変数</span></span>
<span id="cb101-4"><a href="#cb101-4" tabindex="-1"></a>                  <span class="at">what =</span> <span class="st">&quot;effect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="#cb101-5" tabindex="-1"></a>  <span class="fu">as_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-6"><a href="#cb101-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> yvals, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb101-10"><a href="#cb101-10" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.36</span>) <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>, </span>
<span id="cb101-12"><a href="#cb101-12" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">&quot;出場順番の平均限界効果&quot;</span>, </span>
<span id="cb101-13"><a href="#cb101-13" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">&quot;Fig.4: 出場順番の平均限界効果&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-14"><a href="#cb101-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-15"><a href="#cb101-15" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb101-16"><a href="#cb101-16" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>「優勝する確率」と「限界効果」の結果を一つのグラフにまとめて表示する</li>
</ul>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>fig_3 <span class="sc">+</span> fig_4</span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-87-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="左側の-fig_3" class="section level4">
<h4>左側の fig_3</h4>
<ul>
<li>出場順番が 1 から 3 まで変化するにつれて（=
出場が遅くなるほど）<br />
→　<span
style="color:red"><strong>優勝する確率</strong></span>が大きくなっている</li>
</ul>
</div>
<div id="右側の-fig_2-1" class="section level4">
<h4>右側の fig_2</h4>
<ul>
<li>95%信頼区間が縦軸 = 0 と一部交わっている（出場順番が 2 と 3
の場合）<br />
→　「出場順番」(<code>Order3</code>) が 1 の場合のみ統計的に有意</li>
</ul>
</div>
</div>
<div id="棒グラフと線グラフで可視化-1" class="section level3">
<h3>棒グラフと線グラフで可視化</h3>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Winner <span class="sc">~</span> Order3 <span class="sc">+</span> Since <span class="sc">+</span> No_Finals <span class="sc">+</span> Zombie, </span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>            <span class="at">data =</span> df_m1, </span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<ul>
<li><code>df_m1</code> を使って、出場順番 (<code>Order3</code>)
ごとに最終決戦進出に進出する確率を計算する<br />
</li>
<li>結果を <code>Mean_final</code> というデータフレームに格納する</li>
</ul>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>bar_df_m1_w <span class="ot">&lt;-</span> df_m1 <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Order3) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb104-4"><a href="#cb104-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Winner =</span> <span class="fu">mean</span>(Winner))</span>
<span id="cb104-5"><a href="#cb104-5" tabindex="-1"></a>bar_df_m1_w</span></code></pre></div>
<pre><code># A tibble: 3 × 2
  Order3 Mean_Winner
   &lt;dbl&gt;       &lt;dbl&gt;
1      1       0.222
2      2       0.333
3      3       0.471</code></pre>
<ul>
<li>出場順番 (<code>Order3</code>)
ごとに優勝する確率を棒グラフで可視化する</li>
<li><code>model_2</code> の推定結果を線グラフで可視化する</li>
</ul>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a>model_2 <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order3 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="#cb106-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order3)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-5"><a href="#cb106-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-6"><a href="#cb106-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data =</span> bar_df_m1_w,</span>
<span id="cb106-7"><a href="#cb106-7" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> Order3, </span>
<span id="cb106-8"><a href="#cb106-8" tabindex="-1"></a>               <span class="at">y =</span> Mean_Winner), </span>
<span id="cb106-9"><a href="#cb106-9" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;Identity&quot;</span>, </span>
<span id="cb106-10"><a href="#cb106-10" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-11"><a href="#cb106-11" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, </span>
<span id="cb106-12"><a href="#cb106-12" tabindex="-1"></a>                      <span class="at">y =</span> Prediction, </span>
<span id="cb106-13"><a href="#cb106-13" tabindex="-1"></a>                      <span class="at">ymin =</span> lower,  <span class="co"># 進出確率の最小値</span></span>
<span id="cb106-14"><a href="#cb106-14" tabindex="-1"></a>                      <span class="at">ymax =</span> upper), <span class="co"># 進出確率の最大値</span></span>
<span id="cb106-15"><a href="#cb106-15" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb106-16"><a href="#cb106-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Order, </span>
<span id="cb106-17"><a href="#cb106-17" tabindex="-1"></a>                <span class="at">y =</span> Prediction), </span>
<span id="cb106-18"><a href="#cb106-18" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb106-19"><a href="#cb106-19" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb106-21"><a href="#cb106-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;出場順番&quot;</span>,</span>
<span id="cb106-22"><a href="#cb106-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;優勝する確率&quot;</span>,</span>
<span id="cb106-23"><a href="#cb106-23" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;M-1グランプリ (2001-2022)：最終決戦&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-24"><a href="#cb106-24" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-25"><a href="#cb106-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb106-26"><a href="#cb106-26" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) </span></code></pre></div>
<p><img src="R33_logistic1_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="グラフの解釈-1" class="section level4">
<h4>グラフの解釈：</h4>
<ul>
<li><strong>棒グラフ</strong>は単純にそれぞれの出場順番の出場者が最終決戦に出場した確率を表す</li>
</ul>
<div class="sourceCode" id="cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>bar_df_m1_w <span class="ot">&lt;-</span> df_m1 <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Order3) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Winner =</span> <span class="fu">mean</span>(Winner))</span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a>bar_df_m1_w</span></code></pre></div>
<pre><code># A tibble: 3 × 2
  Order3 Mean_Winner
   &lt;dbl&gt;       &lt;dbl&gt;
1      1       0.222
2      2       0.333
3      3       0.471</code></pre>
<ul>
<li><strong>線グラフ</strong>はロジステック回帰分析
(<code>model_2</code>) による推定結果</li>
</ul>
<div class="sourceCode" id="cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>model_2 <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>  <span class="fu">prediction</span>(<span class="at">at =</span> <span class="fu">list</span>(<span class="at">Order3 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="#cb109-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Order&quot;</span> <span class="ot">=</span> <span class="st">&quot;at(Order3)&quot;</span>)</span></code></pre></div>
<pre><code> Order Prediction      SE     z         p   lower  upper
     1     0.2011 0.07818 2.573 1.009e-02 0.04791 0.3544
     2     0.3385 0.06355 5.326 1.003e-07 0.21393 0.4630
     3     0.5066 0.10855 4.666 3.066e-06 0.29379 0.7193</code></pre>
</div>
</div>
<div id="結論" class="section level3">
<h3>結論</h3>
<p>・2001年から2022年までのM1グランプリにおける「出場順番」と「優勝」の関係は次の世にまとめることができる</p>
<div class="kakomi-box11">
<p><span
class="title-box11">結論</span>・<strong>M1決勝</strong>では「出場順番」が遅くなるにつれて最終決戦に選ばれる確率大きくなる<br />
・1 番目に出場する場合、約14%（統計的に有意）<br />
・5 番目に出場する場合、約29%（統計的に有意）<br />
・・・<br />
・10 番目に出場する場合、約56%（統計的に有意）</p>
<p>・<strong>M1最終決戦</strong>では「出場順番」が遅くなるにつれて優勝する確率大きくなる「傾向にある」<br />
・1 番目に出場する場合、約20%（統計的に有意）<br />
・2 番目に出場する場合、約34%<br />
・3 番目に出場する場合、約51%</p>
</div>
</div>
</div>
</div>
<div id="excercise" class="section level1">
<h1>5. Excercise</h1>
<ul>
<li>民主党が政権交代を果たした<strong>2009年総選挙データ</strong>を使って、立候補者が小選挙区で当選したか否か（<code>wlsmd</code>）を応答変数、過去の当選回数（<code>previous</code>）と選挙費用（<code>expm</code>）を説明変数としたロジスティック回帰分析を実行し、以下の各問に答えなさい。<br />
</li>
<li>分析で使うデータは衆院選選挙データは <a
href="https://asanoucla.github.io/hr96-24.csv">hr96-24.csv</a>
からダウンロード。</li>
</ul>
<p><code>Q1.</code>当落（<code>wlsmd</code>）を縦軸に、選挙費用（<code>expm</code>）を横軸にとった散布図（むりやり通常の回帰直線を当てはめた直線）を描きなさい。</p>
<p><code>Q2.</code>当選予測確率を縦軸に、選挙費用（<code>expm</code>）を横軸にとった散布図（<code>wlsmd</code>のオッズをとった曲線）を描きなさい。</p>
<p><code>Q3.</code>立候補者が小選挙区で当選したか否か（<code>wlsmd</code>）を応答変数、選挙費用（<code>expm</code>）を説明変数としたモデルに
<code>model_1</code>
という名前を付けてロジスティック回帰分析し、<code>tidy()</code>関数を使ってその結果を表示しなさい。</p>
<p><code>Q4.</code>立候補者が小選挙区で当選したか否か（<code>wlsmd</code>）を応答変数、過去の当選回数（<code>previous</code>）と選挙費用（<code>expm</code>）を説明変数としたモデルに
<code>model_2</code>
という名前を付けてロジスティック回帰分析し、<code>tidy()</code>関数を使ってその結果を表示しなさい。</p>
<p><code>Q5.</code> <code>model_1</code> と <code>model_2</code>
の分析結果を
<code>stargazer()</code>関数を使って同一の表に示しなさい。</p>
<p><code>Q6.</code> <code>model_2</code> の分析結果の <code>expm</code>
と <code>previous</code>
の係数が何を意味しているのかを説明し、この結果からわかることを述べなさい。</p>
<p><code>Q7.</code> <code>margins::cplot()</code>関数を使って
<code>model_2</code>
の推定結果を表示し、実質的有意性と統計的有意性に関して結論を述べなさい。分析結果は
<code>patchwork</code>パッケージを使って表示させること。</p>
<p><code>Q8.</code> <code>model_2</code>
の予測の的中率を上げるのか下げるのか、解説しなさい。</p>
<p><code>Q9.</code> <code>model_1</code> と <code>model_2</code>
それぞれの ROC
曲線を比較して示し、どちらがよりよいモデルかこたえなさい。</p>
<p><code>Q10.</code> <code>model_2</code>
において、当選回数ごとの予測当選確率とその統計的有意性を
<code>margins::cplot()</code> 関数を使って推定しなさい。</p>
<strong>参考文献</strong><br />

<ul>
<li>
Kieran Healy, DATA VISUALIZATION, Princeton, 2019
</li>
<li>
<a href="https://www.jaysong.net/RBook/">宋財泫 (Jaehyun Song)・矢内勇生
(Yuki Yanai)「私たちのR: ベストプラクティスの探究」</a>
</li>
<li>
浅野正彦, 矢内勇生.『Rによる計量政治学』オーム社、2018年
</li>
<li>
浅野正彦, 中村公亮.『初めてのRStudio』オーム社、2018年
</li>
<li>
Winston Chang, R Graphics Cookbook, O’Reilly Media, 2012.
</li>
<li>
Kosuke Imai, Quantitative Social Science: An Introduction, Princeton
University Press, 2017
</li>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
